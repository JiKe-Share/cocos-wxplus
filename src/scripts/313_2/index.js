window.__require=function e(t,o,n){function i(a,c){if(!o[a]){if(!t[a]){var s=a.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!c&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){return i(t[a][1][e]||e)},u,u.exports,e,t,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({"313_2_BookItem":[function(e,t,o){"use strict";cc._RF.push(t,"96e73tDHVxDnoglE0aBy2wl","313_2_BookItem");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,c=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id=0,t.unlocked=!1,t}return n(t,e),i([c({type:cc.Integer})],t.prototype,"id",void 0),i([c({})],t.prototype,"unlocked",void 0),i([a],t)}(cc.Component);o.default=s,cc._RF.pop()},{}],"313_2_Book":[function(e,t,o){"use strict";cc._RF.push(t,"56f0aQkgcBH7YMFGzIa8z1i","313_2_Book");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=e("AudioManager"),a=e("VideoManager"),c=e("313_2_Config"),s=e("313_2_Role"),l=e("313_2_BookItem"),u=e("313_2_Data"),p=cc._decorator,d=p.ccclass,h=p.property,_=p.inspector,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.item=null,t.pageView=null,t.tipPage=null,t.allPage=null,t.roleCom=null,t.unlockedLabel=null,t._preRoleCount=4,t.curPage=0,t._pageCount=0,t._onPageItemCount=6,t._itemMap=new Map,t}var o;return n(t,e),o=t,t.prototype.onLoad=function(){var e=this;this._createPage(),this.tipPage.active=!1,this.allPage.active=!1,this.pageView.node.active=!1,this.pageView.node.on("page-turning",function(t){e.curPage=t.getCurrentPageIndex()},this)},t.prototype.onEnable=function(){var e=this;this.scheduleOnce(function(){e.updateUnlock(),e.pageView.scrollToPage(e.curPage,0)}),this.show().then(function(){e.node.emit(o.EventType.SHOW)})},t.prototype._createPage=function(){this._pageCount=12/this._onPageItemCount,this._pageCount=this._pageCount%1==0?this._pageCount:Math.floor(this._pageCount)+1;var e=cc.instantiate(this.item);e.parent=this.node;for(var t=this._createItem(),o=function(o){var i=new cc.Node,r=n.pageView.content.parent;i.width=r.width,i.height=r.height;var a=i.addComponent(cc.Layout);a.type=cc.Layout.Type.GRID,a.resizeMode=cc.Layout.ResizeMode.CONTAINER,a.startAxis=cc.Layout.AxisDirection.HORIZONTAL,a.spacingX=i.width/2-e.width,a.spacingY=i.height/3-e.height,a.paddingLeft=a.spacingX/2,a.paddingRight=a.spacingX/2,a.paddingTop=a.spacingY/2,a.paddingBottom=a.spacingY/2,t.splice((o-1)*n._onPageItemCount,n._onPageItemCount).forEach(function(e){e.parent=i}),n.pageView.insertPage(i,0)},n=this,i=0;i<this._pageCount;i++)o(i);e.destroy()},t.prototype._createItem=function(){for(var e=this,t=[],o=c.default.girlName.length-this._preRoleCount,n=function(o){var n=cc.instantiate(i.item),a=n.addComponent(l.default);a.id=o,a.unlocked=-1!=u.default.unlocked.indexOf(a.id),t.push(n);var s=n.getChildByName("icon").getComponentInChildren(cc.Sprite),p=n.getChildByName("lock"),d=n.getChildByName("bg"),h=d.getChildByName("unlock"),_=d.getChildByName("lock"),g=n.getChildByName("name").getComponent(cc.Label);s.spriteFrame=u.default.Instance.head[a.id],s.node.color=a.unlocked?cc.Color.WHITE:cc.Color.BLACK,g.string=c.default.girlName[i._preRoleCount+a.id],p.active=!a.unlocked,h.active=a.unlocked,_.active=!a.unlocked,g.node.active=a.unlocked,i._itemMap.set(a.id,a),n.on(cc.Node.EventType.TOUCH_END,function(){r.default.playEffect(r.default.audioName.BUTTON),e.showTipPage(a.id)},i)},i=this,a=0;a<o;a++)n(a);return t},t.prototype.close=function(){var e=this;r.default.playEffect(r.default.audioName.BUTTON),this.allPage.active=!1,this.tipPage.active=!1,this.pageView.scrollToPage(0,0),this.curPage=0,cc.tween(this.pageView.node).to(.5,{x:-this.pageView.node.width},{easing:cc.easing.fade}).call(function(){e.node.active=!1,e.pageView.node.active=!1}).start()},t.prototype.showTipPage=function(e){var t=this;this.tipPage.active=!0;var o=this.tipPage.getChildByName("content"),n=o.getChildByName("yes"),i=o.getChildByName("close"),s=o.getChildByName("unlock"),l=o.getChildByName("tip").getComponent(cc.Label),p=o.getChildByName("role").getComponentInChildren(cc.Sprite),d=-1!=u.default.unlocked.indexOf(e),h=-1!=u.default.unlockedTip.indexOf(e),_=e+this._preRoleCount+1,g="\u7b2c\u4e00\u9636\u6bb5\u5582\u517b"+c.default.itemsName[Math.floor(e/3)]+"\n\u7b2c\u4e8c\u9636\u6bb5\u5582\u517b"+c.default.itemsName[_-1]+"\n\u5373\u53ef\u517b\u6210"+c.default.girlName[_-1],f=o.getChildByName("name").getComponent(cc.Label);n.active=d||h,i.active=!d&&!h,s.active=!d&&!h,l.string=d?c.default.girlInfo[e]:h?g:"\u662f\u5426\u67e5\u770b\u5973\u513f\u517b\u6210\u65b9\u5f0f",p.spriteFrame=this.roleCom.roleImg[_],p.node.color=d?cc.Color.WHITE:cc.Color.BLACK,f.string=c.default.girlName[_-1],f.node.active=d,cc.tween(o).set({scale:0,active:!0}).to(.5,{scale:1},{easing:cc.easing.backOut}).call(function(){n.on(cc.Node.EventType.TOUCH_END,t.hideHintScreen,t),i.on(cc.Node.EventType.TOUCH_END,t.hideHintScreen,t),s.on(cc.Node.EventType.TOUCH_END,function(){a.default.getInstance().showVideo(function(){r.default.playEffect(r.default.audioName.BUTTON),l.string=g,n.active=!0,i.active=!1,s.active=!1,u.default.unlockTip(e)})},t)}).start()},t.prototype.hideHintScreen=function(){var e=this;r.default.playEffect(r.default.audioName.BUTTON);var t=this.tipPage.getChildByName("content"),o=t.getChildByName("yes"),n=t.getChildByName("close"),i=t.getChildByName("unlock");o.off(cc.Node.EventType.TOUCH_END),n.off(cc.Node.EventType.TOUCH_END),i.off(cc.Node.EventType.TOUCH_END),cc.tween(t).to(.5,{scale:0},{easing:cc.easing.backIn}).call(function(){e.tipPage.active=!1}).start()},t.prototype.unlockItem=function(e){var t=this,n=e-this._preRoleCount-1;if(u.default.unlock(n)){var i=Math.floor(n/this._onPageItemCount);return this.curPage=i,this.node.once(o.EventType.SHOW,function(){t.scheduleOnce(function(){t.pageView.scrollToPage(t.curPage,0),t._unlockAni(n).then(function(){t.showTipPage(n),u.default.unlocked.length===c.default.girlName.length-t._preRoleCount&&t.scheduleOnce(function(){t.showUnlockAll()},3)})},.5)},this),this.node.active=!0,!0}return!1},t.prototype.show=function(){var e=this;return new Promise(function(t){e.pageView.node.x=-e.pageView.node.width,e.pageView.node.active=!0,cc.tween(e.pageView.node).to(.5,{x:0},{easing:cc.easing.fade}).call(function(){t()}).start()})},t.prototype.showUnlockAll=function(){var e=this;cc.tween(this.allPage).set({scale:0,active:!0}).to(.5,{scale:1},{easing:cc.easing.backOut}).call(function(){e.allPage.getChildByName("yes").on(cc.Node.EventType.TOUCH_END,e.closeAllPage,e),r.default.playEffect(r.default.audioName.VICTORY)}).start()},t.prototype.closeAllPage=function(){var e=this;this.allPage.getChildByName("yes").off(cc.Node.EventType.TOUCH_END),cc.tween(this.allPage).to(.5,{scale:0},{easing:cc.easing.backIn}).call(function(){e.allPage.active=!1}).start()},t.prototype.prePage=function(){var e=this.curPage-1;e<0||(r.default.playEffect(r.default.audioName.BUTTON),this.pageView.scrollToPage(e,.5),this.curPage=e)},t.prototype.nextPage=function(){var e=this.curPage+1;e>=this._pageCount||(r.default.playEffect(r.default.audioName.BUTTON),this.pageView.scrollToPage(e,.5),this.curPage=e)},t.prototype._unlockAni=function(e){var t=this;return new Promise(function(o){var n=t._itemMap.get(e),i=n.node.getChildByName("icon").getComponentInChildren(cc.Sprite),a=n.node.getChildByName("lock"),c=n.node.getChildByName("bg"),s=c.getChildByName("unlock"),l=c.getChildByName("lock"),u=n.node.getChildByName("name");a.active=!1,cc.tween(i.node).to(.5,{color:cc.Color.WHITE},{easing:cc.easing.sineIn}).set({scale:.9}).to(.2,{scale:1},{easing:cc.easing.backOut}).call(function(){s.active=!0,l.active=!1,u.active=!0,r.default.playEffect(r.default.audioName.VICTORY)}).delay(.5).call(function(){t.pageView.enabled=!0,o()}).start()})},t.prototype.updateUnlock=function(){this.unlockedLabel.string=""+u.default.unlocked.length},t.EventType={SHOW:"show"},i([h({type:cc.Prefab})],t.prototype,"item",void 0),i([h({type:cc.PageView})],t.prototype,"pageView",void 0),i([h({type:cc.Node})],t.prototype,"tipPage",void 0),i([h({type:cc.Node})],t.prototype,"allPage",void 0),i([h({type:s.default})],t.prototype,"roleCom",void 0),i([h({type:cc.Label})],t.prototype,"unlockedLabel",void 0),o=i([d,_("packages://autoproperty//inspector.js")],t)}(cc.Component);o.default=g,cc._RF.pop()},{"313_2_BookItem":"313_2_BookItem","313_2_Config":"313_2_Config","313_2_Data":"313_2_Data","313_2_Role":"313_2_Role",AudioManager:void 0,VideoManager:void 0}],"313_2_Config":[function(e,t,o){"use strict";cc._RF.push(t,"c0c1b9kJldI96JqcXS0+gzk","313_2_Config"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.feedCount1=4,e.feedCount2=12,e.itemsName=["\u6eba\u7231","\u8d23\u5907","\u8774\u8776\u7ed3","\u6c49\u5821","\u4e66\u672c","\u5154\u5b50","\u905b\u72d7","\u9488\u7b52","\u62f3\u5957","\u624b\u673a","\u7435\u7436","\u5e94\u63f4\u68d2","\u88d9\u5b50","\u53ef\u4e50","\u8df3\u7ef3","\u725b\u8089"],e.itemsBuff=["\u5143\u6c14(\u7eff)","\u53db\u9006(\u7ea2)","\u53ef\u7231(\u7eff)","\u8102\u80aa(\u7ea2)","\u77e5\u8bc6(\u7eff)","\u6d3b\u529b(\u7eff)","\u6c14\u8d28(\u7ea2)","\u75c5\u5a07(\u7ea2)","\u66b4\u529b(\u7ea2)","\u6e38\u620f(\u7eff)","\u53e4\u98ce(\u7eff)","\u4e8c\u6b21\u5143(\u7eff)","\u7f8e\u4e3d(\u7eff)","\u80a5\u5b85(\u7ea2)","\u8fd0\u52a8(\u7eff)","\u808c\u8089(\u7ea2)"],e.girlName=["\u5143\u6c14\u5973\u5b69","\u53db\u9006\u5973\u5b69","\u53ef\u7231\u5973\u5b69","\u80d6\u5973\u5b69","JK\u5c11\u5973","\u5154\u8033\u5c11\u5973","\u5fa1\u59d0","\u75c5\u5a07\u5c11\u5973","\u4e0d\u826f\u5c11\u5973","\u7f51\u7edc\u4e3b\u64ad","\u53e4\u88c5\u5c11\u5973","\u4e8c\u6b21\u5143\u5c11\u5973","\u6d1b\u4e3d\u5854\u5973\u5b69","\u5b85\u5973","\u8fd0\u52a8\u5c11\u5973","\u808c\u8089\u5c11\u5973"],e.girlInfo=["\u6027\u683c\u817c\u8146\uff0c\u559c\u6b22\u6ce1\u5728\u56fe\u4e66\u9986\u8bfb\u4e66","\u9752\u6625\u6d3b\u6cfc\uff0c\u559c\u6b22Cosplay\u548c\u732a\u5934\u5c11\u5e74","\u6027\u683c\u9ad8\u51b7\uff0c\u4f46\u5185\u5fc3\u5176\u5b9e\u662f\u4e2a\u5f1f\u63a7","\u559c\u6b22\u6492\u5a07\uff0c\u60c5\u611f\u590d\u6742\uff0c\u6709\u70b9\u5c0f\u5fc3\u773c","\u6027\u683c\u66b4\u529b\uff0c\u53e3\u5934\u7985\u662f\u201c\u6253\u4e00\u67b6\u5427\u201d","\u70ed\u7231\u5206\u4eab\u65e5\u5e38\u751f\u6d3b\uff0c\u662f\u4e2a\u76f4\u64ad\u8fbe\u4eba","\u559c\u6b22\u7a7f\u6c49\u670d\uff0c\u949f\u60c5\u53e4\u98ce\uff0c\u7cbe\u901a\u7434\u68cb\u4e66\u753b","\u6df1\u5ea6\u4e8c\u523a\u733f\u60a3\u8005\uff0c\u559c\u6b22\u52a8\u6f2b","\u7cbe\u81f4\u53ef\u7231\uff0c\u559c\u6b22\u751c\u7f8e\u7684\u88c5\u626e","\u559c\u6b22\u770b\u5267\u6253\u6e38\u620f\uff0c\u6709\u5b85\u5bb6\u7684\u4e60\u60ef","\u70ed\u7231\u8fd0\u52a8\uff0c\u559c\u6b22\u8bf4\u201c\u6e38\u6cf3\u5065\u8eab\u4e86\u89e3\u4e00\u4e0b\u201d","\u559c\u6b22\u5065\u8eab\uff0c\u770b\u7740\u5f3a\u58ee\u5176\u5b9e\u6709\u9897\u5c11\u5973\u5fc3"],e.AUIDO={tap:"lv313_2_1",compose:"lv313_2_2",get:"lv313_2_3"},e}();o.default=n,cc._RF.pop()},{}],"313_2_Data":[function(e,t,o){"use strict";cc._RF.push(t,"4a01ePaCt5M863cgk99Hrzn","313_2_Data");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameData"),a=cc._decorator,c=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.head=[],t}var o;return n(t,e),o=t,Object.defineProperty(t,"Instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){e.prototype.onLoad&&e.prototype.onLoad.call(this),this.init(),o._instance=this},t.prototype.init=function(){o.dataUpdate()},t.unlock=function(e){return-1==this.unlocked.indexOf(e)&&(this.unlocked.push(e),this.storage(),!0)},t.unlockTip=function(e){return-1==this.unlockedTip.indexOf(e)&&(this.unlockedTip.push(e),this.storage(),!0)},t.dataUpdate=function(){var e,t=cc.sys.localStorage.getItem(r.default.serrectKey+"_Data_313_2");t&&(e=JSON.parse(t),this.unlocked=e[0],this.unlockedTip=e[1])},t.storage=function(){cc.sys.localStorage.setItem(r.default.serrectKey+"_Data_313_2",JSON.stringify([this.unlocked,this.unlockedTip]))},t.unlocked=[],t.unlockedTip=[],t._instance=null,i([s({type:[cc.SpriteFrame]})],t.prototype,"head",void 0),o=i([c],t)}(cc.Component);o.default=l,cc._RF.pop()},{GameData:void 0}],"313_2_Float":[function(e,t,o){"use strict";cc._RF.push(t,"fcfd62tYeVMa4aJrn93z/PM","313_2_Float");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,c=r.property,s=r.inspector,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type_=[],t.typePool_=[],t}return n(t,e),t.prototype.onLoad=function(){this.typePool_=[];for(var e=0,t=this.type_;e<t.length;e++){t[e];var o=new cc.NodePool;this.typePool_.push(o)}},t.prototype.start=function(){},t.prototype.showFloat=function(e,t){var o=this,n=this._getType(e);n.parent=this.node,n.setPosition(cc.v2(0)),n.opacity=255,n.getChildByName("lbl").getComponent(cc.Label).string=t,cc.tween(n).by(.5,{position:cc.v3(0,100)}).by(.2,{opacity:-255}).call(function(){o._putType(e,n)}).start()},t.prototype._getType=function(e){var t=this.typePool_[e].get();return t||(t=cc.instantiate(this.type_[e])),t},t.prototype._putType=function(e,t){this.typePool_[e].put(t)},i([c({type:[cc.Node]})],t.prototype,"type_",void 0),i([a,s("packages://autoproperty//inspector.js")],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],"313_2_Items":[function(e,t,o){"use strict";cc._RF.push(t,"c237eZPKY5GSoOxtm3h2Mlo","313_2_Items");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=e("AudioManager"),a=e("313_2_Config"),c=cc._decorator,s=c.ccclass,l=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itemsNode=null,t.itemsSpriteFrame=[],t.clickInterval=.2,t._isInInterval=!1,t._items=[],t._itemsIdx=[],t._aniSpritePool=[],t}var o;return n(t,e),o=t,t.prototype.onLoad=function(){this.initItems()},t.prototype.onEnable=function(){this._isInInterval=!1,this.itemsNode.children.forEach(function(e){e.getComponent(cc.Button).interactable=!0})},t.prototype.onDisable=function(){this.itemsNode.children.forEach(function(e){e.getComponent(cc.Button).interactable=!1})},t.prototype.initItems=function(){var e=this;this._items=this.itemsNode.children,this._items.forEach(function(t,o){e._changeItemsSpriteFrame(o,-1),t.on(cc.Node.EventType.TOUCH_END,e._onClickItem,e)})},t.prototype.setItems=function(e,t,o){var n=this;this._itemsIdx=[e,t,o],this._itemsIdx.forEach(function(e,t){n._changeItemsSpriteFrame(t,e)})},t.prototype.hideBtns=function(){this.itemsNode.active=!1},t.prototype.showBtns=function(){this.itemsNode.active=!0},t.prototype._changeItemsSpriteFrame=function(e,t){if(t<0)this._items[e].active=!1;else{var o=this._items[e],n=o.getChildByName("sprite"),i=o.getChildByName("title"),r=n.getComponentInChildren(cc.Sprite),c=a.default.itemsName[t];c&&(i.getComponent(cc.Label).string=c),r.spriteFrame=this.itemsSpriteFrame[t],o.active=!0}},t.prototype._onClickItem=function(e){var t=this;if(!this._isInInterval){this._isInInterval=!0,r.default.playEffect(r.default.audioName.BUTTON);var n=e.target,i=this._items.indexOf(n),a=this._itemsIdx[i];this.node.emit(o.EventType.ITEM_CLICK,i,a),this.scheduleOnce(function(){t._isInInterval=!1},this.clickInterval)}},t.prototype.flyToRoleAni=function(e,t){var o=this;return new Promise(function(n){var i=o._items[e],r=t.getComponentInChildren(cc.Sprite),a=t.convertToWorldSpaceAR(cc.v3(0,Math.abs(r.node.height/2))),c=i.getChildByName("sprite"),s=o.node.convertToNodeSpaceAR(a),l=c.children[0],u=o._aniSpritePool.pop()||new cc.Node;u.scale=1,u.position=o.node.convertToNodeSpaceAR(l.convertToWorldSpaceAR(cc.v3(0,0))),u.addComponent(cc.Sprite).spriteFrame=l.getComponent(cc.Sprite).spriteFrame,u.parent=o.node,cc.tween(u).to(.5,{position:s}).to(.1,{scale:0}).call(function(){n(),o._aniSpritePool.push(u)}).start()})},t.EventType={ITEM_CLICK:"ITEM_CLICK"},i([l({type:cc.Node})],t.prototype,"itemsNode",void 0),i([l({type:[cc.SpriteFrame]})],t.prototype,"itemsSpriteFrame",void 0),i([l({type:cc.Float})],t.prototype,"clickInterval",void 0),o=i([s],t)}(cc.Component);o.default=u,cc._RF.pop()},{"313_2_Config":"313_2_Config",AudioManager:void 0}],"313_2_LevelCtrl":[function(e,t,o){"use strict";cc._RF.push(t,"117daW62+BOoaB4kx4/sBo3","313_2_LevelCtrl");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=e("313_2_Float"),a=e("313_2_Items"),c=e("313_2_Role"),s=e("313_2_Screen"),l=e("313_2_Config"),u=e("313_2_Data"),p=e("313_2_Book"),d=e("ListenerType"),h=e("LevelCtrl_CommonResult"),_=e("AssetManager"),g=e("AudioManager"),f=e("ListenerManager"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.inspector,N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.screen=null,t.bg=null,t.role=null,t.progress=null,t.age=null,t.result=null,t.endTitle=null,t.endBtns=null,t.items=null,t.float=null,t.fireworks=null,t.bookBtn=null,t.book=null,t._addProgress=[.15,.15,.2,.2,.3],t._feedWeights=[],t._curItems=[],t._curFeed=0,t._curStage=1,t._curProgress=0,t._isEnterStage=!1,t._curRole=0,t}return n(t,e),t.prototype.onLoad=function(){this.book.active=!0},t.prototype.start=function(){this.setScene(1),this.setAge(6,"\u4e2a\u6708"),this._feedWeights=Array.from({length:l.default.itemsName.length},function(){return 0}),this._curItems=Array.from({length:4},function(e,t){return t}),this._curItems.splice(Math.floor(4*Math.random()),1),this._curItems.sort(function(){return Math.random()-.5}),this.items.setItems(this._curItems[0],this._curItems[1],this._curItems[2]),this._curRole=0,this._curFeed=0,this._curStage=1,this.result.active=!1,this.endTitle.active=!1,this.endBtns.active=!1,this._isEnterStage=!1,this._curProgress=0,this.bookBtn.active=!1,this.book.active=!1,this.updateProgress(),this.items.node.on(a.default.EventType.ITEM_CLICK,this._onItemClick,this),this.bookBtn.on(cc.Node.EventType.TOUCH_END,this.showBook,this),_.default.loadSoundEffect_fileDir("AudioClip/lv_313/2")},t.prototype._onItemClick=function(e,t){var o=this;if(!this._isEnterStage){this._curFeed++,this._curFeed>=5&&(this._isEnterStage=!0,this.items.hideBtns());var n=this._isEnterStage,i=this._curFeed;this.items.flyToRoleAni(e,this.role.node).then(function(){o._onFeedEnd(t,n,i)}),this._feedWeights[t]++}},t.prototype._onFeedEnd=function(e,t,o){this.role.useItemAni(),this.showBuff(e),this._curProgress+=this._addProgress[o-1],this.updateProgress(),t&&this._enterNextStage()},t.prototype._enterNextStage=function(){var e=this;switch(this._isEnterStage=!1,this._curStage++,this._curFeed=0,this._curStage){case 2:this._updateRoleByWeight(),this._curProgress=0,this.playFireworks(),this.role.changeRole(this._curRole).then(function(){e.setAge(8),e.updateProgress();var t=l.default.itemsName.slice(4+3*(e._curRole-1),4+3*e._curRole);e._curItems=t.map(function(e){return l.default.itemsName.indexOf(e)}),e._curItems.forEach(function(t){e._feedWeights[t]=5}),e._curItems.sort(function(){return Math.random()-.5}),e.items.setItems(e._curItems[0],e._curItems[1],e._curItems[2]),e.items.showBtns()});break;case 3:this._updateRoleByWeight(),this.screen.transition(function(){e.setScene(2)}).then(function(){return e.setAge(16),e.role.changeRole(e._curRole)}).then(function(){return e.playFireworks()}).then(function(){e.result.getComponentInChildren(cc.Label).string=l.default.girlName[e._curRole-1];var t=e.result.getChildByName("name").getComponent(cc.Label),o=e.result.getChildByName("info").getComponent(cc.Label);t.string=l.default.girlName[e._curRole-1],o.string=l.default.girlInfo[e._curRole-1-4],e.result.active=!0,e.endTitle.active=!0,e.endBtns.active=!0,e.bookBtn.active=!0,e.updateBookNum(),e.unlockBook(e._curRole)})}},t.prototype.showBook=function(){this.book.active=!0,this.bookBtn.active=!1,g.default.playEffect(g.default.audioName.BUTTON)},t.prototype.closeBook=function(){this.bookBtn.active=!0,this.book.getComponent(p.default).close()},t.prototype.updateBookNum=function(){var e=this.bookBtn.getChildByName("num"),t=e.getChildByName("now").getComponent(cc.Label),o=e.getChildByName("total").getComponent(cc.Label);t.string=""+u.default.unlocked.length,o.string=""+(l.default.itemsName.length-4)},t.prototype.unlockBook=function(e){this.book.getComponent(p.default).unlockItem(e)&&this.updateBookNum()},t.prototype.showBuff=function(e){var t=l.default.itemsBuff[e].split("("),o=t[0],n=t[1].includes("\u7eff")?0:1;this.float.showFloat(n,o)},t.prototype.playFireworks=function(){var e=this;return new Promise(function(t){e.fireworks.node.active=!0,g.default.playEffect(l.default.AUIDO.get),e.fireworks.addEventListener(dragonBones.EventObject.COMPLETE,function(){t(),e.fireworks.node.active=!1},e),e.fireworks.playAnimation("caidai-3",1)})},t.prototype.setScene=function(e){this.bg.getChildByName("1").active=1==e,this.bg.getChildByName("2").active=2==e,this.age.active=1==e,this.progress.node.active=1==e},t.prototype.setAge=function(e,t){void 0===t&&(t="\u5c81"),this.age.getChildByName("num").getComponent(cc.Label).string=e.toString(),this.age.getChildByName("suffix").getComponent(cc.Label).string=t},t.prototype.updateProgress=function(){var e=this._curProgress;this.progress.progress=e,this.progress.node.getChildByName("light").active=e>=1},t.prototype.restart=function(){f.default.getInstance().trigger(d.default.RESTART_GAME)},t.prototype.end=function(){this.node.getComponent(h.default).onGameSucc()},t.prototype._updateRoleByWeight=function(){var e=Math.max.apply(Math,this._feedWeights),t=this._feedWeights.map(function(t,o){return t==e?o:-1}).filter(function(e){return-1!=e}),o=t[Math.floor(Math.random()*t.length)];this._curRole=o+1},i([v({type:s.default})],t.prototype,"screen",void 0),i([v({type:cc.Node})],t.prototype,"bg",void 0),i([v({type:c.default})],t.prototype,"role",void 0),i([v({type:cc.ProgressBar})],t.prototype,"progress",void 0),i([v({type:cc.Node})],t.prototype,"age",void 0),i([v({type:cc.Node})],t.prototype,"result",void 0),i([v({type:cc.Node})],t.prototype,"endTitle",void 0),i([v({type:cc.Node})],t.prototype,"endBtns",void 0),i([v({type:a.default})],t.prototype,"items",void 0),i([v({type:r.default})],t.prototype,"float",void 0),i([v({type:dragonBones.ArmatureDisplay})],t.prototype,"fireworks",void 0),i([v({type:cc.Node})],t.prototype,"bookBtn",void 0),i([v({type:cc.Node})],t.prototype,"book",void 0),i([y,C("packages://autoproperty//inspector.js")],t)}(cc.Component);o.default=N,cc._RF.pop()},{"313_2_Book":"313_2_Book","313_2_Config":"313_2_Config","313_2_Data":"313_2_Data","313_2_Float":"313_2_Float","313_2_Items":"313_2_Items","313_2_Role":"313_2_Role","313_2_Screen":"313_2_Screen",AssetManager:void 0,AudioManager:void 0,LevelCtrl_CommonResult:void 0,ListenerManager:void 0,ListenerType:void 0}],"313_2_Role":[function(e,t,o){"use strict";cc._RF.push(t,"5332d8i5X9CxYJ9yYEUAcvy","313_2_Role");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=e("AudioManager"),a=e("313_2_Config"),c=cc._decorator,s=c.ccclass,l=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.roleImg=[],t.imgNode=null,t}return n(t,e),t.prototype.onLoad=function(){cc.tween(this.node).to(1.5,{scaleY:1.02}).to(1.5,{scaleY:1}).union().repeatForever().start(),this.imgNode=new cc.Node,this.imgNode.addComponent(cc.Sprite).spriteFrame=this.roleImg[0],this.node.addChild(this.imgNode),this.imgNode.anchorY=0,this.imgNode.scale=.9,cc.tween(this.imgNode).to(.5,{scale:1},{easing:cc.easing.backOut}).start()},t.prototype.changeRole=function(e){var t=this;return new Promise(function(o){cc.tween(t.imgNode).to(.5,{scale:1.1},{easing:cc.easing.backOut}).call(function(){t.imgNode.getComponent(cc.Sprite).spriteFrame=t.roleImg[e]}).to(.5,{scale:1},{easing:cc.easing.backOut}).call(function(){o()}).start()})},t.prototype.useItemAni=function(){var e=this;return new Promise(function(t){r.default.playEffect(a.default.AUIDO.compose),cc.tween(e.imgNode).set({scale:.9}).to(.5,{scale:1},{easing:e.easing}).call(function(){t()}).start()})},t.prototype.easing=function(e){return 1.5-Math.abs(.5-e)},i([l({type:[cc.SpriteFrame]})],t.prototype,"roleImg",void 0),i([s],t)}(cc.Component);o.default=u,cc._RF.pop()},{"313_2_Config":"313_2_Config",AudioManager:void 0}],"313_2_Screen":[function(e,t,o){"use strict";cc._RF.push(t,"ecffciX07FLzZ8+uAE+r9MP","313_2_Screen");var n=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,c=r.property,s=r.inspector,l=r.requireComponent,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scene=null,t.renderCover=null,t._camera=null,t._curRenderTexture=null,t._nextRenderTexture=null,t._curFrame=null,t._nextFrame=null,t._progress=0,t._isTransition=!1,t}return n(t,e),t.prototype.onLoad=function(){this._camera=this.getComponent(cc.Camera),this._camera.alignWithScreen=!1,this._camera.orthoSize=Math.max(this.scene.width,this.scene.height)/2*1.5,this._camera.node.setPosition(this._camera.node.parent.convertToNodeSpaceAR(this.scene.convertToWorldSpaceAR(cc.v3((.5-this.scene.anchorX)*this.scene.width,(.5-this.scene.anchorY)*this.scene.height,this._camera.nearClip+1)))),this._curRenderTexture=new cc.RenderTexture,this._curRenderTexture.initWithSize(this.scene.width,this.scene.height),this._nextRenderTexture=new cc.RenderTexture,this._nextRenderTexture.initWithSize(this.scene.width,this.scene.height),this._camera.targetTexture=this._curRenderTexture,this._curFrame=new cc.SpriteFrame(this._curRenderTexture),this._curFrame.uv=[0,0,1,0,0,1,1,1],this._nextFrame=new cc.SpriteFrame(this._nextRenderTexture),this._nextFrame.uv=[0,0,1,0,0,1,1,1],this._curFrame.addRef(),this._nextFrame.addRef()},t.prototype.start=function(){this._camera.enabled=!1},t.prototype.update=function(){this._isTransition&&this.renderCover.getMaterial(0).setProperty("progress",this._progress)},t.prototype.onDisable=function(){this._nextFrame.decRef(),this._curFrame.decRef()},t.prototype.transition=function(e,t,o){var n=this;return void 0===t&&(t=1),void 0===o&&(o=cc.easing.smooth),new Promise(function(i){n.enabled&&(n._isTransition=!0,n._progress=0,n.renderOnce(n._curRenderTexture),n.renderCover.spriteFrame=n._curFrame,n.renderCover.node.opacity=255,n.renderCover.node.active=!0,n.renderCover.getMaterial(0).setProperty("curTexture",n._curFrame.getTexture()),n.renderCover.getMaterial(0).setProperty("progress",n._progress),e(),n.scheduleOnce(function(){n.renderOnce(n._nextRenderTexture),n.renderCover.spriteFrame=n._nextFrame,n.node.width=0,cc.tween(n.node).to(t,{width:1},{easing:o,progress:function(e,t,o,i){n._progress=i}}).call(function(){cc.tween(n.renderCover.node).to(.2,{opacity:0}).call(function(){i(),n._isTransition=!1,n.renderCover.node&&(n.renderCover.node.active=!1)}).start()}).start()}))})},t.prototype.renderOnce=function(e){this._camera.targetTexture=e,this._camera.render(this.scene),this._camera.targetTexture=null},i([c({type:cc.Node})],t.prototype,"scene",void 0),i([c({type:cc.Sprite})],t.prototype,"renderCover",void 0),i([a,l(cc.Camera),s("packages://autoproperty//inspector.js")],t)}(cc.Component);o.default=u,cc._RF.pop()},{}]},{},["313_2_Config","313_2_Float","313_2_Items","313_2_LevelCtrl","313_2_Role","313_2_Screen","313_2_Book","313_2_BookItem","313_2_Data"]);