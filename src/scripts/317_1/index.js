window.__require=function e(t,o,n){function c(r,s){if(!o[r]){if(!t[r]){var a=r.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+r+"'")}r=a}var d=o[r]={exports:{}};t[r][0].call(d.exports,function(e){return c(t[r][1][e]||e)},d,d.exports,e,t,o,n)}return o[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<n.length;r++)c(n[r]);return c}({"317_1_LevelCtrl":[function(e,t,o){"use strict";cc._RF.push(t,"f0e55s9JEZK34vtr/hW1QE9","317_1_LevelCtrl");var n=__extends,c=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var i=e("LevelCtrl_CommonResult"),r=e("AssetManager"),s=e("AudioManager"),a=cc._decorator,l=a.ccclass,d=a.property;a.inspector;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.leftHand=null,t.rightHand=null,t.face=null,t.body=null,t.notch=null,t.knife=null,t.line=null,t.bandage=null,t.lineDone=null,t.progress=null,t.guideLabel=null,t.tool=null,t.guides=[],t.knifeTool=null,t.needle=null,t.tweezers=null,t.bandageTool=null,t.curFace=-1,t}return n(t,e),t.prototype.onLoad=function(){this.tweezers=this.tool.children[0],this.needle=this.tool.children[1],this.bandageTool=this.tool.children[2],this.knifeTool=this.tool.children[3],this.tool.children.forEach(function(e){return e.active=!1}),this.guides.forEach(function(e){return e.active=!1}),this.guides[0].active=!0,this.progress.node.active=!1,this.knife.active=!1;var e=this.notch.children[0].children[0];cc.tween(e).to(1,{scale:1.01}).to(1,{scale:1}).union().repeatForever().start()},t.prototype.start=function(){var e=this;r.default.loadSoundEffect_fileDir("AudioClip/lv_317/1");var t=this.notch.getComponent(cc.Mask);t._graphics.clear(),t.inverted=!1,this.showFace(2),this.showToolNode(this.knifeTool).then(function(){return e.task_0()}).then(function(){return e.showFace(0),e.guides[1].active=!0,e.task_1()}).then(function(){return s.default.playEffect("lv317_1_task"),e.guides[0].active&&(e.guides[0].active=!1),e.showToolNode(e.tweezers)}).then(function(){return e.task_2()}).then(function(){return s.default.playEffect("lv317_1_task"),e.showToolNode(e.needle)}).then(function(){return e.task_3()}).then(function(){return s.default.playEffect("lv317_1_task"),e.guides[2].active=!0,e.task_4()}).then(function(){return e.guides[3].active=!0,e.progress.progress=0,e.task_5()}).then(function(){s.default.playEffect("lv317_1_fin"),e.showFace(2),e.scheduleOnce(function(){e.node.getComponent(i.default).onGameSucc()},2)}).catch(function(){})},t.prototype.showFace=function(e){if(this.curFace!==e)switch(this.curFace=e,this.face.children.forEach(function(t){return t.active=t.name.includes(""+e)}),this.leftHand.stopAllActions(),this.rightHand.stopAllActions(),e){case 0:break;case 1:cc.tween(this.leftHand).to(.1,{x:110}).to(.2,{x:108}).to(.1,{x:109}).delay(3).union().repeatForever().start(),cc.tween(this.rightHand).to(.1,{x:-112}).to(.2,{x:-110}).to(.1,{x:-111}).delay(3).union().repeatForever().start();break;case 2:cc.tween(this.leftHand).to(.5,{angle:15}).to(.5,{angle:0}).delay(5).union().repeatForever().start(),cc.tween(this.rightHand).to(.5,{angle:-15}).to(.5,{angle:0}).delay(5).union().repeatForever().start()}},t.prototype.showToolNode=function(e){return new Promise(function(t){e.x-=720,e.opacity=0,e.active=!0,cc.tween(e).by(.5,{opacity:255,x:720}).call(t).start()})},t.prototype.task_0=function(){var e=this;return new Promise(function(t){e.guideLabel.string="\u62d6\u52a8\u624b\u672f\u5200\u4e0a\u53bb";var o=e.knifeTool.getPosition();e.knife.opacity=0;var n=function(t){e.knifeTool.setPosition(e.knifeTool.getPosition().add(t.getDelta().mul(.6666666666666666)))},c=function c(){e.knifeTool.off(cc.Node.EventType.TOUCH_MOVE,n),e.knifeTool.off(cc.Node.EventType.TOUCH_END,c),e.knifeTool.off(cc.Node.EventType.TOUCH_CANCEL,c),e.knifeTool.getBoundingBoxToWorld().intersects(e.body.getBoundingBoxToWorld())||e.body.getBoundingBoxToWorld().contains(e.knifeTool.convertToWorldSpaceAR(cc.v2(0)))?cc.tween(e.knifeTool).to(.2,{scale:0,opacity:0}).call(function(){e.knife.active=!0,cc.tween(e.knife).to(.2,{scale:1,opacity:255}).call(function(){t()}).start(),e.knifeTool.active=!1}).start():(e.knifeTool.setPosition(o),e.knifeTool.scale=.9)};e.knifeTool.on(cc.Node.EventType.TOUCH_START,function(){e.knifeTool.on(cc.Node.EventType.TOUCH_MOVE,n),e.knifeTool.on(cc.Node.EventType.TOUCH_END,c),cc.tween(e.knifeTool).to(.2,{scale:1}).start()})})},t.prototype.task_1=function(){var e=this;return new Promise(function(t){e.guideLabel.string="\u62d6\u52a8\u624b\u672f\u5200\u5212\u5f00\u4f24\u53e3";var o=e.knife.children[0],n=e.notch.getComponent(cc.Mask),c=n._graphics;c.clear(),n.inverted=!1;var i=e.notch.width/2,r=!0,a=0,l=function(t){var o=2*-t.getDelta().y/3;e.knife.y-=o,o>0&&(a+=o),a>e.notch.height?p():u()},d=function(){a>.9*e.notch.height&&p()},u=function(){r&&(r=!1,s.default.playEffect("lv317_1_knife")),e.showFace(1),e.guides[1].active&&(e.guides[1].active=!1);var t=e.knife.convertToWorldSpaceAR(cc.v2(0)),o=e.notch.convertToNodeSpaceAR(t);c.circle(o.x,o.y+i,i),c.fill()},p=function(){o.off(cc.Node.EventType.TOUCH_MOVE,l),o.off(cc.Node.EventType.TOUCH_END,d),o.off(cc.Node.EventType.TOUCH_CANCEL,d);var n=e.notch.convertToNodeSpaceAR(e.knife.convertToWorldSpaceAR(cc.v2(0))).y+e.notch.height/2,c=n/500;cc.tween(e.knife).by(c,{y:-n},{easing:function(e){return u(),e}}).to(.5,{scale:1.2,opacity:0,position:cc.v3(60,-300)}).call(function(){t()}).start()};o.on(cc.Node.EventType.TOUCH_MOVE,l),o.on(cc.Node.EventType.TOUCH_END,d),o.on(cc.Node.EventType.TOUCH_CANCEL,d)})},t.prototype.task_2=function(){var e=this;return new Promise(function(t){e.guideLabel.string="\u62d6\u52a8\u954a\u5b50\u5c06\u5c0f\u8304\u5b50\u53d6\u51fa";var o=e.notch.children[0].children[0],n=e.tweezers.getPosition(),c=e.tweezers.getChildByName("target"),i=function(){cc.tween(e.tweezers).to(.2,{scale:1}).start(),u()},r=function(t){e.tweezers.setPosition(e.tweezers.parent.convertToNodeSpaceAR(t.getLocation()))},a=function(){l()?(p(),o.parent=c,o.setPosition(cc.Vec2.ZERO),d()):(e.tweezers.setPosition(n),e.tweezers.scale=.8)},l=function(){return!!e.tweezers.getBoundingBoxToWorld().intersects(o.getBoundingBoxToWorld())},d=function(){s.default.playEffect("lv317_1_bop"),cc.tween(e.tweezers).to(.5,{opacity:0,position:cc.v3(300,480)}).call(function(){t(),e.tweezers.active=!1}).start()},u=function(){e.tweezers.children.forEach(function(e){e.on(cc.Node.EventType.TOUCH_MOVE,r),e.on(cc.Node.EventType.TOUCH_END,a),e.on(cc.Node.EventType.TOUCH_CANCEL,a)})},p=function(){e.tweezers.children.forEach(function(e){e.off(cc.Node.EventType.TOUCH_START,i),e.off(cc.Node.EventType.TOUCH_MOVE,r),e.off(cc.Node.EventType.TOUCH_END,a),e.off(cc.Node.EventType.TOUCH_CANCEL,a)})};e.tweezers.children.forEach(function(e){e.on(cc.Node.EventType.TOUCH_START,i)})})},t.prototype.task_3=function(){var e=this;return new Promise(function(t){e.guideLabel.string="\u62d6\u52a8\u9488\u7f1d\u4f24\u53e3";var o=e.needle.getPosition(),n=function(t){e.needle.setPosition(e.needle.getPosition().add(t.getDelta().mul(.6666666666666666)))},c=function c(){i?(e.needle.off(cc.Node.EventType.TOUCH_MOVE,n),e.needle.off(cc.Node.EventType.TOUCH_END,c),e.needle.off(cc.Node.EventType.TOUCH_CANCEL,c),r().then(function(){return a()}).then(function(){t()})):e.needle.setPosition(o)},i=function(){return!(!e.needle.getBoundingBoxToWorld().intersects(e.body.getBoundingBoxToWorld())&&!e.body.getBoundingBoxToWorld().contains(e.needle.convertToWorldSpaceAR(cc.v2(0))))},r=function(){return new Promise(function(t){cc.tween(e.needle).to(.2,{position:cc.v3(70,440),scale:0}).call(function(){t(),e.needle.active=!1}).start()})},a=function(){return new Promise(function(t){var o=e.line.getComponent(cc.Sprite);s.default.playEffect("lv317_1_sewing").then(function(e){cc.tween(o).to(2,{fillStart:0}).call(function(){cc.audioEngine.stop(e),t()}).start()})})};e.needle.on(cc.Node.EventType.TOUCH_MOVE,n),e.needle.on(cc.Node.EventType.TOUCH_END,c),e.needle.on(cc.Node.EventType.TOUCH_CANCEL,c)})},t.prototype.task_4=function(){var e=this;return new Promise(function(t){e.guideLabel.string="\u624b\u6307\u6ed1\u52a8\u5c06\u4f24\u53e3\u7f1d\u5408";var o=e.lineDone.width/e.notch.width;e.progress.node.active=!0,e.progress.progress=0;var n=0,c=!0,i=-1,r=function(t){c&&(c=!1,cc.tween(e.notch).to(.5,{scaleX:o}).start());var i=2*-t.getDelta().y/3;i<0||(n=(n+=i/e.lineDone.height)>1?1:n,d())},a=function(){n>.9&&u()},l=function(){e.line.off(cc.Node.EventType.TOUCH_MOVE,r),e.line.off(cc.Node.EventType.TOUCH_END,a),e.line.off(cc.Node.EventType.TOUCH_CANCEL,a),e.notch.off(cc.Node.EventType.TOUCH_MOVE,r),e.notch.off(cc.Node.EventType.TOUCH_END,a),e.notch.off(cc.Node.EventType.TOUCH_CANCEL,a)},d=function(){e.guides[2].active&&(e.guides[2].active=!1),e.progress.progress=n;var c=e.line.getComponent(cc.Sprite),r=e.lineDone.getComponent(cc.Sprite);c.fillRange=1-n,r.fillStart=1-n,e.notch.scaleX=o*(1-n),-1===i&&(s.default.playEffect("lv317_1_merge").then(function(e){i=e}),e.scheduleOnce(function(){cc.audioEngine.stop(i),i=-1},1)),n>=1&&(e.notch.stopAllActions(),e.notch.scaleX=0,c.fillRange=0,r.fillStart=0,l(),t())},u=function(){l();var o=e.line.getComponent(cc.Sprite),n=e.lineDone.getComponent(cc.Sprite);cc.tween(e.notch).to(.5,{scaleX:0}).start(),cc.tween(o).to(.5,{fillRange:0}).start(),cc.tween(n).to(.5,{fillStart:0}).start(),t()};e.line.on(cc.Node.EventType.TOUCH_MOVE,r),e.line.on(cc.Node.EventType.TOUCH_END,a),e.line.on(cc.Node.EventType.TOUCH_CANCEL,a),e.notch.on(cc.Node.EventType.TOUCH_MOVE,r),e.notch.on(cc.Node.EventType.TOUCH_END,a),e.notch.on(cc.Node.EventType.TOUCH_CANCEL,a)})},t.prototype.task_5=function(){var e=this;return new Promise(function(t){e.guideLabel.string="\u6ed1\u52a8\u624b\u6307\u8d34\u4e0a\u521b\u5ba2\u8d34";var o=e.bandage.getComponent(cc.Mask),n=o._graphics;o.inverted=!1,n.clear();var c=e.bandage.width/2,i=cc.v3(0,-e.bandage.height/2),r=0,s=function(t){var o=2*t.getDelta().y/3;o<0||(r=(r+=o/e.bandage.height)>1?1:r,i.y+=o,l())},a=function(){r>.9&&d()},l=function(){e.guides[3].active&&(e.guides[3].active=!1),e.progress.progress=r,n.circle(i.x,i.y,c),n.fill(),e.bandageTool.setPosition(i),r>=1&&(u(),t())},d=function(){u(),cc.tween(i).to(.5,{y:e.bandage.height/2},{progress:function(t,o,n,c){n=cc.misc.lerp(t,o,c),i.y=n,r=(r=(i.y+e.bandage.height/2)/e.bandage.height)>1?1:r,l()}}).start()},u=function(){e.bandage.off(cc.Node.EventType.TOUCH_MOVE,s),e.bandage.off(cc.Node.EventType.TOUCH_END,a),e.bandage.off(cc.Node.EventType.TOUCH_CANCEL,a)};e.bandage.on(cc.Node.EventType.TOUCH_MOVE,s),e.bandage.on(cc.Node.EventType.TOUCH_END,a),e.bandage.on(cc.Node.EventType.TOUCH_CANCEL,a)})},c([d({type:cc.Node})],t.prototype,"leftHand",void 0),c([d({type:cc.Node})],t.prototype,"rightHand",void 0),c([d({type:cc.Node})],t.prototype,"face",void 0),c([d({type:cc.Node})],t.prototype,"body",void 0),c([d({type:cc.Node})],t.prototype,"notch",void 0),c([d({type:cc.Node})],t.prototype,"knife",void 0),c([d({type:cc.Node})],t.prototype,"line",void 0),c([d({type:cc.Node})],t.prototype,"bandage",void 0),c([d({type:cc.Node})],t.prototype,"lineDone",void 0),c([d({type:cc.ProgressBar})],t.prototype,"progress",void 0),c([d({type:cc.Label})],t.prototype,"guideLabel",void 0),c([d({type:cc.Node})],t.prototype,"tool",void 0),c([d({type:[cc.Node]})],t.prototype,"guides",void 0),c([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{AssetManager:void 0,AudioManager:void 0,LevelCtrl_CommonResult:void 0}],"317_Guide":[function(e,t,o){"use strict";cc._RF.push(t,"082d0zzz0ZNd5pGgegdB8Ag","317_Guide");var n,c=__extends,i=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var r,s=cc._decorator,a=s.ccclass,l=s.property,d=s.inspector;(r=n||(n={}))[r.CLICK=1]="CLICK",r[r.SLIDE=2]="SLIDE",r[r.BEZIER=3]="BEZIER";var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.guide=null,t.guideType=n.CLICK,t.startPos=cc.v2(0,0),t.controlPos1=cc.v2(0,0),t.controlPos2=cc.v2(0,0),t.endPos=cc.v2(0,0),t.moveSpeed=500,t.onLoadCall=!1,t.isScale=!1,t.targetScale=1,t.endCall=[],t._originScale=1,t}return c(t,e),t.prototype.onLoad=function(){this.onLoadCall?this.showGuide():(this._originScale=(this.guide||this.node).scale,this.hideGuide())},t.prototype.onDisable=function(){this.hideGuide()},t.prototype.showGuide=function(){var e=this,t=this.guide||this.node;t.active=!0,this._originScale=t.scale;var o=function(){return e.isScale?cc.tween().to(.1,{scale:e.targetScale}):cc.tween().show()},c=function(){return e.isScale?cc.tween().to(.1,{scale:e._originScale}).delay(.2):cc.tween().show()},i=this.endPos.sub(this.startPos).mag()/this.moveSpeed,r=(this.controlPos1.sub(this.startPos).mag()+this.controlPos2.sub(this.controlPos1).mag()+this.endPos.sub(this.controlPos2).mag())/this.moveSpeed;switch(this.guideType){case n.CLICK:t.setPosition(this.startPos),cc.tween(t).to(.5,{scale:this.targetScale},{easing:cc.easing.quadOut}).call(function(){cc.Component.EventHandler.emitEvents(e.endCall,e)}).to(.5,{scale:this._originScale}).union().repeatForever().start();break;case n.SLIDE:cc.tween(t).set({position:cc.v3(this.startPos)}).sequence(o(),cc.tween().to(i,{position:this.endPos}),c(),cc.tween().call(function(){cc.Component.EventHandler.emitEvents(e.endCall,e)})).start();break;case n.BEZIER:cc.tween(t).set({position:cc.v3(this.startPos)}).sequence(o(),cc.tween().bezierTo(r,this.controlPos1,this.controlPos2,this.endPos),c(),cc.tween().call(function(){cc.Component.EventHandler.emitEvents(e.endCall,e)})).start()}},t.prototype.hideGuide=function(){var e=this.guide||this.node;e.stopAllActions(),e.setPosition(this.startPos),e.scale=this._originScale,e.active=!1},i([l({type:cc.Node})],t.prototype,"guide",void 0),i([l({type:cc.Enum(n)})],t.prototype,"guideType",void 0),i([l({})],t.prototype,"startPos",void 0),i([l({visible:function(){return this.guideType===n.BEZIER}})],t.prototype,"controlPos1",void 0),i([l({visible:function(){return this.guideType===n.BEZIER}})],t.prototype,"controlPos2",void 0),i([l({visible:function(){return this.guideType!==n.CLICK}})],t.prototype,"endPos",void 0),i([l({visible:function(){return this.guideType!==n.CLICK}})],t.prototype,"moveSpeed",void 0),i([l({})],t.prototype,"onLoadCall",void 0),i([l({visible:function(){return this.guideType!==n.CLICK}})],t.prototype,"isScale",void 0),i([l({visible:function(){return this.guideType===n.CLICK||this.isScale}})],t.prototype,"targetScale",void 0),i([l({type:[cc.Component.EventHandler]})],t.prototype,"endCall",void 0),i([a,d("packages://autoproperty/inspector.js")],t)}(cc.Component);o.default=u,cc._RF.pop()},{}]},{},["317_Guide","317_1_LevelCtrl"]);