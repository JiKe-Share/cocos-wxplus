window.__require=function e(t,n,o){function i(c,a){if(!n[c]){if(!t[c]){var d=c.split("/");if(d=d[d.length-1],!t[d]){var s="function"==typeof __require&&__require;if(!a&&s)return s(d,!0);if(r)return r(d,!0);throw new Error("Cannot find module '"+c+"'")}c=d}var p=n[c]={exports:{}};t[c][0].call(p.exports,function(e){return i(t[c][1][e]||e)},p,p.exports,e,t,n,o)}return n[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<o.length;c++)i(o[c]);return i}({"311_1_BoxLimit":[function(e,t,n){"use strict";cc._RF.push(t,"25aaaSZcvtOGI20Totbd1pe","311_1_BoxLimit");var o=__extends,i=__decorate;Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass;r.property;var a=r.executeInEditMode,d=r.requireComponent,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return o(t,e),n=t,t.prototype.onload=function(){this.node.removeComponent(n)},t.prototype.update=function(){},t.prototype.adjustChildrenPosition=function(){this.node.getComponent(cc.Widget).top=0,this.node.getComponent(cc.Widget).bottom=0,this.node.getComponent(cc.Widget).right=50,this.node.getComponent(cc.Widget).left=50;var e=this.node.children.sort(function(e,t){return-(e.getBoundingBox().width+e.getBoundingBox().height)+(t.getBoundingBox().width+t.getBoundingBox().height)}),t=Math.min(168/e.reduce(function(e,t){return Math.max(e,t.height)},0),1),n=this.node.getBoundingBox();e.forEach(function(e,o){e.scale=t,e.setSiblingIndex(o),e.x+(1-e.anchorX)*e.width*t>n.xMax&&(e.x=n.xMax-(1-e.anchorX)*e.width*t),e.x-e.anchorX*e.width*t<n.xMin&&(e.x=n.xMin+e.anchorX*e.width*t),e.y+(1-e.anchorY)*e.height*t>n.yMax&&(e.y=n.yMax-(1-e.anchorY)*e.height*t),e.y-e.anchorY*e.height*t<n.yMin&&(e.y=n.yMin+e.anchorY*e.height*t)})},n=i([c,d(cc.Widget),a],t)}(cc.Component);n.default=s,cc._RF.pop()},{}],"311_1_Config":[function(e,t,n){"use strict";cc._RF.push(t,"830faRNy1pBuayWszQLLIk4","311_1_Config"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.checkGroup=[[!1,!1,!0,!1],[!0,!1,!0,!0],[!0,!1,!1,!1],[!0,!0,!0,!1]],e}();n.default=o,cc._RF.pop()},{}],"311_1_ContainerOpenFunc":[function(e,t,n){"use strict";cc._RF.push(t,"7877aTagddG/KEOjxucGrFv","311_1_ContainerOpenFunc"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.openClosetDrawer=function(e){var t=e.getChildByName("open");cc.tween(t).to(.2,{position:cc.v3(-2,72)}).start()},e.closeClosetDrawer=function(e){var t=e.getChildByName("open");cc.tween(t).to(.2,{position:cc.v3(0,83)}).start()},e.openCommon=function(e){e.getChildByName("open").active=!0,e.getChildByName("close").active=!1},e.closeCommon=function(e){e.getChildByName("open").active=!1,e.getChildByName("close").active=!0},e}();n.default=o,cc._RF.pop()},{}],"311_1_ContainerSys":[function(e,t,n){"use strict";cc._RF.push(t,"8c322G6Rc1Kip4ZGIuR4mbn","311_1_ContainerSys");var o=__extends,i=__decorate;Object.defineProperty(n,"__esModule",{value:!0});var r=e("311_1_ContainerOpenFunc"),c=e("311_1_Container"),a=cc._decorator,d=a.ccclass,s=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mainUIContainer=null,t._containerList=[],t._curClickContainer=null,t}return o(t,e),t.prototype.initContainer=function(){var e=this,t=this.mainUIContainer.getComponentsInChildren(c.default).filter(function(e){return e.node.active});this._containerList=this._containerList.concat(t);for(var n=function(t){t.containerNode.on(cc.Node.EventType.TOUCH_START,o._handleTapBegin,o),t.containerNode.on(cc.Node.EventType.TOUCH_END,o._onTouchEndArea,o,!0),t.node.getChildByName("open")&&(t.node.getChildByName("open").on(cc.Node.EventType.TOUCH_START,function(n){n.target=t.containerNode,e._handleTapBegin(n)},o),t.node.getChildByName("open").on(cc.Node.EventType.TOUCH_END,function(n){n.target=t.containerNode,e._onTouchEndArea(n)},o),t.node.getChildByName("open").children.forEach(function(n){n.on(cc.Node.EventType.TOUCH_START,function(n){n.target=t.containerNode,e._handleTapBegin(n)},e),n.on(cc.Node.EventType.TOUCH_END,function(n){n.target=t.containerNode,e._onTouchEndArea(n)},e,!0)})),t.node.getChildByName("close")&&(t.node.getChildByName("close").on(cc.Node.EventType.TOUCH_START,function(n){n.target=t.containerNode,e._handleTapBegin(n)},o),t.node.getChildByName("close").on(cc.Node.EventType.TOUCH_END,function(n){n.target=t.containerNode,e._onTouchEndArea(n)},o,!0),t.node.getChildByName("close").children.forEach(function(n){n.on(cc.Node.EventType.TOUCH_START,function(n){n.target=t.containerNode,e._handleTapBegin(n)},e),n.on(cc.Node.EventType.TOUCH_END,function(n){n.target=t.containerNode,e._onTouchEndArea(n)},e)}))},o=this,i=0,r=this._containerList;i<r.length;i++)n(r[i])},t.prototype._handleTapBegin=function(e){var t=this._containerList.find(function(t){return t.containerNode===e.target});t&&(this._curClickContainer=t,e.stopPropagationImmediate())},t.prototype._onTouchEndArea=function(){this._curClickContainer&&(this._curClickContainer.isOpen?this._closeContainer(this._curClickContainer):this._openContainer(this._curClickContainer),this._curClickContainer=null)},t.prototype._openContainer=function(e){switch(e.containerType){case 0:break;case 1:r.default.openClosetDrawer(e.node),e.itemNodes.forEach(function(e){e.active=!0}),e.isOpen=!0;break;default:r.default.openCommon(e.node),e.itemNodes.forEach(function(e){e.active=!0}),e.isOpen=!0}},t.prototype._closeContainer=function(e){switch(e.containerType){case 0:break;case 1:r.default.closeClosetDrawer(e.node),e.itemNodes.forEach(function(e){e.active=!1}),e.isOpen=!1;break;default:r.default.closeCommon(e.node),e.itemNodes.forEach(function(e){e.active=!1}),e.isOpen=!1}},i([s({type:cc.Node})],t.prototype,"mainUIContainer",void 0),i([d],t)}(cc.Component);n.default=p,cc._RF.pop()},{"311_1_Container":"311_1_Container","311_1_ContainerOpenFunc":"311_1_ContainerOpenFunc"}],"311_1_Container":[function(e,t,n){"use strict";cc._RF.push(t,"4c6daZ2UA1HS6IDbIzVDsVk","311_1_Container");var o=__extends,i=__decorate;Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,a=r.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.containerType=0,t.isOpen=!1,t.containerNode=null,t.itemNodes=[],t}return o(t,e),i([a({type:cc.Integer})],t.prototype,"containerType",void 0),i([a({})],t.prototype,"isOpen",void 0),i([a({type:cc.Node})],t.prototype,"containerNode",void 0),i([c],t)}(cc.Component);n.default=d,cc._RF.pop()},{}],"311_1_ItemSys":[function(e,t,n){"use strict";cc._RF.push(t,"89df9x5xuVIIJM4j1DpYYGd","311_1_ItemSys");var o,i=__extends,r=__decorate;Object.defineProperty(n,"__esModule",{value:!0}),n.EItemState=void 0;var c,a=e("311_1_Config"),d=e("311_1_Item"),s=e("311_1_Container"),p=cc._decorator,l=p.ccclass,u=p.property;(c=o=n.EItemState||(n.EItemState={}))[c.None=0]="None",c[c.Drag=1]="Drag",c[c.Drop=2]="Drop",c[c.Placed=3]="Placed",c[c.Fixed=4]="Fixed";var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itemNode=null,t.dropNode=null,t.maxOverlap=0,t._curDragItem=null,t._curContainer=null,t._dragOffset=cc.v2(0,65),t._itemList=[],t}var n;return i(t,e),n=t,t.prototype.onLoad=function(){this.itemNode.children.forEach(function(e){e.active=!1})},t.prototype.update=function(){if(this._curDragItem){this.checkItemPos(this._curDragItem);var e=this.itemNode.parent.convertToNodeSpaceAR(this._curDragItem.node.convertToWorldSpaceAR(cc.v2(0,0))),t=this._curDragItem.node.getBoundingBoxToWorld();t.x=e.x-t.width/2,t.y=e.y-t.height/2,this.itemNode.getBoundingBox().intersects(t)||this._curDragItem.state!=o.Drop&&this.node.emit(n.EventType.ITEM_CANNOT_PLACE,"\u4e0d\u80fd\u653e\u5728\u8fd9\u91cc")}},t.prototype.initItem=function(e){e.originIndex=e.node.getSiblingIndex(),e.originParent=e.node.parent,e.originPosition=e.node.getPosition(),e.originScale=e.node.scale,e.node.on(cc.Node.EventType.TOUCH_START,this.dragStart,this),e.node.on(cc.Node.EventType.TOUCH_MOVE,this.dragMove,this),e.node.on(cc.Node.EventType.TOUCH_END,this.dragEnd,this),e.node.on(cc.Node.EventType.TOUCH_CANCEL,this.dragEnd,this)},t.prototype.showItem=function(e){var t=this,n=this.itemNode.getChildByName("item_"+e);n.opacity=0,n.active=!0,cc.tween(n).to(.5,{opacity:255}).call(function(){var e=n.getComponentsInChildren(d.default).filter(function(e){return e.node.active});e.forEach(function(e){t.initItem(e)}),t._itemList=t._itemList.concat(e)}).start()},t.prototype.anchoredObject=function(){var e=this;this._itemList.forEach(function(t){t.state===o.Placed&&(t.state=o.Fixed,t.node.off(cc.Node.EventType.TOUCH_START,e.dragStart,e),t.node.off(cc.Node.EventType.TOUCH_MOVE,e.dragMove,e),t.node.off(cc.Node.EventType.TOUCH_END,e.dragEnd,e),t.node.off(cc.Node.EventType.TOUCH_CANCEL,e.dragEnd,e))})},t.prototype.dragStart=function(e){var t=e.target,i=t.getComponent(d.default);i&&(this._curDragItem||i.state!==o.None&&i.state!==o.Placed||(this._curDragItem=i,i.state===o.None&&i.node.setPosition(i.node.getPosition().add(this._dragOffset)),i.state=o.Drag,cc.tween(t).to(.1,{scale:1}).start(),t.setSiblingIndex(t.parent.childrenCount-1),this.checkItemPos(i),this.node.emit(n.EventType.DRAG_ITEM,i),e.stopPropagationImmediate()))},t.prototype.dragMove=function(e){var t=e.target,n=t.getComponent(d.default);n&&this._curDragItem&&(n.state!==o.Drag&&n.state!==o.Drop||(t.setPosition(t.getPosition().add(e.getDelta().mul(1/t.parent.scale*2/3))),e.stopPropagationImmediate()))},t.prototype.dragEnd=function(e){var t=e.target.getComponent(d.default);t&&this._curDragItem&&(t.state!==o.Drag&&t.state!==o.Drop||(this.checkItemPos(t),this.node.emit(n.EventType.DRAG_ITEM_END,t),t.state===o.Drop?this.dropItem(t):this.resetItem(t),this._curDragItem=null,e.stopPropagationImmediate()))},t.prototype.checkItemPos=function(e){var t=this,n=e.node;switch(e.type){case d.EItemType.FloorBig:case d.EItemType.FloorSmall:case d.EItemType.FloorDecorate:e.targetParent=this.dropNode.getChildByName("floor");break;case d.EItemType.Wall:e.targetParent=this.dropNode.getChildByName("wall");break;default:if(!e.isInContainer){for(var i=void 0,r=0,c=this._itemList;r<c.length;r++){for(var p=0,l=c[r].getComponentsInChildren(s.default);p<l.length;p++){var u=l[p];if(u.containerType===e.containerType&&u.isOpen&&u.containerNode.getBoundingBoxToWorld().intersects(n.getBoundingBoxToWorld())){i=u;break}}if(i)break}e.targetParent=null==i?void 0:i.containerNode,e.container=i}e.targetParent||(e.targetParent=this.dropNode)}if(this.dropNode.getBoundingBox().contains(this.dropNode.parent.convertToNodeSpaceAR(n.convertToWorldSpaceAR(cc.v2(0,0))))){if(e.targetParent.getBoundingBox().contains(e.targetParent.parent.convertToNodeSpaceAR(n.convertToWorldSpaceAR(cc.v2(0,0))))){if(e.type===d.EItemType.None)return void(e.state=o.Drop);var _=!0,h=a.default.checkGroup.length;return a.default.checkGroup.forEach(function(i,r){if(i[e.type-1])for(var c=0,a=t._itemList.filter(function(e){return e.type===h-r&&e.state===o.Placed});c<a.length;c++){var d=a[c],s=new cc.Rect;if(d.node.getBoundingBoxToWorld().intersection(s,n.getBoundingBoxToWorld()),s.width>0&&s.height>0&&s.width*s.height>Math.min(n.width*n.height,d.node.width*d.node.height)*(t.maxOverlap/100)&&(!d.node.getComponent(cc.PolygonCollider)||!n.getComponent(cc.PolygonCollider)||cc.Intersection.polygonPolygon(t.getWorldPoints(d.node),t.getWorldPoints(n)))){_=!1;break}}}),void(e.state=_?o.Drop:o.Drag)}if(e.type===d.EItemType.None)return e.targetParent=this.dropNode,void(e.state=o.Drop)}e.targetParent=null,e.state=o.Drag},t.prototype.dropItem=function(e){if(e.state===o.Drop){var t=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),i=e.targetParent.convertToNodeSpaceAR(t);e.node.stopAllActions(),e.node.scale=1,e.node.setParent(e.targetParent),e.node.setPosition(i),e.node.zIndex=e.priority,e.state=o.Placed,e.type===d.EItemType.None&&(e.targetParent===this.dropNode||null===e.targetParent?(e.container&&e.container.itemNodes.splice(e.container.itemNodes.indexOf(e.node),1),e.isInContainer=!1):(-1===e.container.itemNodes.indexOf(e.node)&&e.container.itemNodes.push(e.node),e.isInContainer=!0)),this.node.emit(n.EventType.PLACE_ITEM,e),this._itemList.filter(function(e){return e.state!==o.Fixed}).every(function(e){return e.state===o.Placed})&&this.node.emit(n.EventType.ITEM_BAR_PLACED)}},t.prototype.resetItem=function(e){e.state==o.Drag&&(e.node.stopAllActions(),e.node.scale=e.originScale,e.node.setParent(e.originParent),e.node.setPosition(e.originPosition),e.node.setSiblingIndex(e.originIndex),e.state=o.None,e.type===d.EItemType.None&&(this._itemList.filter(function(e){return e.node.getComponent(s.default)}).map(function(e){return e.node.getComponent(s.default)}).forEach(function(t){t.itemNodes.splice(t.itemNodes.indexOf(e.node),1)}),e.isInContainer=!1),this.node.emit(n.EventType.RESETITEM,e))},t.prototype.getWorldPoints=function(e){return e.getComponent(cc.PolygonCollider).points.map(function(t){return e.convertToWorldSpaceAR(t)})},t.EventType={PLACE_ITEM:"PlaceItem",DRAG_ITEM:"DragItem",DRAG_ITEM_END:"DragItemEnd",RESETITEM:"ResetItem",ITEM_BAR_PLACED:"ItemBarPlaced",ITEM_CANNOT_PLACE:"ItemCannotPlace"},r([u({type:cc.Node})],t.prototype,"itemNode",void 0),r([u({type:cc.Node})],t.prototype,"dropNode",void 0),r([u({type:cc.Integer})],t.prototype,"maxOverlap",void 0),n=r([l],t)}(cc.Component);n.default=_,cc._RF.pop()},{"311_1_Config":"311_1_Config","311_1_Container":"311_1_Container","311_1_Item":"311_1_Item"}],"311_1_Item":[function(e,t,n){"use strict";cc._RF.push(t,"485011S8IhEkJBIdiYFGZxe","311_1_Item");var o,i=__extends,r=__decorate;Object.defineProperty(n,"__esModule",{value:!0}),n.EItemType=void 0;var c,a=cc._decorator,d=a.ccclass,s=a.property;(c=o=n.EItemType||(n.EItemType={}))[c.None=0]="None",c[c.FloorBig=1]="FloorBig",c[c.FloorSmall=2]="FloorSmall",c[c.Wall=3]="Wall",c[c.FloorDecorate=4]="FloorDecorate";var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=0,t.type=0,t.priority=1,t.containerType=0,t.originIndex=0,t.originParent=null,t.originPosition=cc.v2(0,0),t.originScale=1,t.targetParent=null,t.container=null,t.isInContainer=!1,t}return i(t,e),r([s({type:cc.Integer})],t.prototype,"state",void 0),r([s({type:cc.Enum(o)})],t.prototype,"type",void 0),r([s({type:cc.Integer})],t.prototype,"priority",void 0),r([s({type:cc.Integer})],t.prototype,"containerType",void 0),r([d],t)}(cc.Component);n.default=p,cc._RF.pop()},{}],"311_1_LvCtrl":[function(e,t,n){"use strict";cc._RF.push(t,"5d978GPNKJAOqmsBaZ12lrp","311_1_LvCtrl");var o=__extends,i=__decorate;Object.defineProperty(n,"__esModule",{value:!0});var r=e("LevelCtrl_CommonResult"),c=e("311_1_ContainerSys"),a=e("311_1_ItemSys"),d=cc._decorator,s=d.ccclass,p=d.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnFinish=null,t.invalidPlacementHint=null,t._curStage=0,t._itemSys=null,t._containerSys=null,t}return o(t,e),t.prototype.onLoad=function(){this._itemSys=this.node.getComponent(a.default),this._containerSys=this.node.getComponent(c.default),this._itemSys.node.on(a.default.EventType.ITEM_BAR_PLACED,this._onItemBarPlaced,this),this._itemSys.node.on(a.default.EventType.ITEM_CANNOT_PLACE,this._showCannotPlaceTip,this),this.btnFinish.node.active=!1,this.invalidPlacementHint.opacity=0,this.invalidPlacementHint.active=!1},t.prototype.start=function(){this._itemSys.showItem(1),this.btnFinish.node.on(cc.Node.EventType.TOUCH_END,this._onBtnFinishClick,this)},t.prototype._onItemBarPlaced=function(){switch(this._curStage){case 0:this._itemSys.anchoredObject(),this._itemSys.showItem(2),this._containerSys.initContainer(),this._curStage++;break;case 1:this.btnFinish.node.scale=0,this.btnFinish.node.active=!0,cc.tween(this.btnFinish.node).to(.5,{scale:1},{easing:"backOut"}).start()}},t.prototype._onBtnFinishClick=function(){this._itemSys.anchoredObject(),this.node.getComponent(r.default).onGameSucc()},t.prototype._showCannotPlaceTip=function(e){var t=this;this.invalidPlacementHint.getComponentInChildren(cc.Label).string=e,this.invalidPlacementHint.stopAllActions(),this.invalidPlacementHint.opacity=255,this.invalidPlacementHint.active=!0,cc.tween(this.invalidPlacementHint).to(.2,{opacity:0}).call(function(){t.invalidPlacementHint.active=!1}).start()},i([p({type:cc.Button})],t.prototype,"btnFinish",void 0),i([p({type:cc.Node})],t.prototype,"invalidPlacementHint",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{"311_1_ContainerSys":"311_1_ContainerSys","311_1_ItemSys":"311_1_ItemSys",LevelCtrl_CommonResult:void 0}]},{},["311_1_BoxLimit","311_1_Config","311_1_ContainerOpenFunc","311_1_ContainerSys","311_1_ItemSys","311_1_LvCtrl","311_1_Container","311_1_Item"]);