window.__require=function t(e,i,o){function n(c,a){if(!i[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var u=i[c]={exports:{}};e[c][0].call(u.exports,function(t){return n(e[c][1][t]||t)},u,u.exports,t,e,i,o)}return i[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<o.length;c++)n(o[c]);return n}({"327_6_DialogCom":[function(t,e,i){"use strict";cc._RF.push(e,"ad99eGDaGhGoqEqZ17q8wf0","327_6_DialogCom");var o=__extends,n=__decorate;Object.defineProperty(i,"__esModule",{value:!0});var r=t("327_6_DialogSys"),c=cc._decorator,a=c.ccclass,s=c.property;c.inspector;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.text=null,e.textStr="",e.showTime=.1,e.stayTime=.2,e.hideTime=.5,e.autoHide=!0,e.state=0,e}return o(e,t),e.prototype.onLoad=function(){cc.director.emit(r.default.EventType.REGISTER_DIALOG_COM,this)},n([s({})],e.prototype,"id",void 0),n([s({type:cc.Label})],e.prototype,"text",void 0),n([s({})],e.prototype,"textStr",void 0),n([s({})],e.prototype,"showTime",void 0),n([s({})],e.prototype,"stayTime",void 0),n([s({})],e.prototype,"hideTime",void 0),n([s({})],e.prototype,"autoHide",void 0),n([a],e)}(cc.Component);i.default=l,cc._RF.pop()},{"327_6_DialogSys":"327_6_DialogSys"}],"327_6_DialogSys":[function(t,e,i){"use strict";cc._RF.push(e,"45fb7RzSztMRKMqd/yB2oHz","327_6_DialogSys");var o,n,r=__extends,c=__decorate;Object.defineProperty(i,"__esModule",{value:!0}),i.DialogComEvent=void 0;var a,s=cc._decorator,l=s.ccclass;s.property,(a=o||(o={}))[a.Show=0]="Show",a[a.Stay=1]="Stay",a[a.Hide=2]="Hide",a[a.Disable=3]="Disable",function(t){t.SHOW_COMPLETE="SHOW_COMPLETE",t.STAY_COMPLETE="STAY_COMPLETE",t.HIDE_COMPLETE="HIDE_COMPLETE"}(n||(n={})),i.DialogComEvent=n;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._dialogComs=[],e}var i;return r(e,t),i=e,e.prototype.onLoad=function(){var t=this;cc.director.on(i.EventType.REGISTER_DIALOG_COM,function(e){t._dialogComs.indexOf(e)>=0||(e.state=o.Disable,t._dialogComs.push(e))},this),cc.director.on(i.EventType.SHOW_DIALOG,this.showDialog,this),cc.director.on(i.EventType.SHOW_DIALOG_IMMED,this.showDialogImmed,this),cc.director.on(i.EventType.HIDE_DIALOG,this.hideDialog,this),cc.director.on(i.EventType.HIDE_DIALOG_IMMED,this.hideDialogImmed,this),cc.director.on(i.EventType.HIDE_ALL_DIALOG,this.hideAllDialog,this)},e.prototype.update=function(){var t=this.diaLogComs;if(!(t.length<=0))for(var e=0,i=t;e<i.length;e++){var n=i[e];if(n.state===o.Disable&&n.enabled){var r=n.node;r.stopAllActions(),r.opacity=0,r.active=!1}}},Object.defineProperty(e.prototype,"diaLogComs",{get:function(){return this._dialogComs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curDialogNodes",{get:function(){return this.diaLogComs.filter(function(t){return t.state!==o.Disable}).map(function(t){return t.node})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasShowDialog",{get:function(){return this.curDialogNodes.length>0},enumerable:!1,configurable:!0}),e.prototype.setDialogAttrById=function(t,e){void 0===e&&(e=0);for(var i=0,o=this.diaLogComs;i<o.length;i++){var n=o[i];n.id===e&&Object.assign(n,t)}},e.prototype.showDialog=function(t,e,i){void 0===e&&(e=0);var o=this.diaLogComs.filter(function(t){return t.id===e&&t.enabled});if(0!==o.length)for(var n=function(e){var n=e,c=o[n],a=c.text||c.node.getComponentInChildren(cc.Label);if(!a)return"continue";a.string=c.textStr=t,r._showDialogASM(c).then(function(){n===o.length-1&&i&&i()})},r=this,c=0;c<o.length;c++)n(c)},e.prototype.showDialogImmed=function(t,e,i){void 0===e&&(e=0);var r=this.diaLogComs.filter(function(t){return t.id===e&&t.enabled});if(0!==r.length)for(var c=function(e){var c=e,s=r[c],l=s.text||s.node.getComponentInChildren(cc.Label);if(!l)return"continue";l.string=s.textStr=t;var u=s.node;u.stopAllActions(),u.opacity=255,u.emit(n.SHOW_COMPLETE),s.state=o.Stay,a._showDialogASM(s).then(function(){c===r.length-1&&i&&i()})},a=this,s=0;s<r.length;s++)c(s)},e.prototype.hideDialog=function(t,e){void 0===t&&(t=0);var i=this.diaLogComs.filter(function(e){return e.id===t&&e.enabled});if(0!==i.length)for(var o=function(t){var o=t,r=i[o];n._concealPromptASM(r).then(function(){o===i.length-1&&e&&e()})},n=this,r=0;r<i.length;r++)o(r)},e.prototype.hideDialogImmed=function(t,e){void 0===t&&(t=0);var i=this.diaLogComs.filter(function(e){return e.id===t&&e.enabled});if(0!==i.length)for(var r=function(t){var r=t,a=i[r],s=a.node;s.stopAllActions(),s.opacity=0,s.emit(n.HIDE_COMPLETE),a.state=o.Disable,c._concealPromptASM(a).then(function(){r===i.length-1&&e&&e()}),s.active=!1},c=this,a=0;a<i.length;a++)r(a)},e.prototype.hideAllDialog=function(){var t=this;this.diaLogComs.forEach(function(e){t._concealPromptASM(e)})},e.prototype.hideAllDialogImmed=function(){this.diaLogComs.forEach(function(t){var e=t.node;e.stopAllActions(),e.opacity=0,e.emit(n.HIDE_COMPLETE),t.state=o.Disable})},e.prototype._showDialogASM=function(t){var e=this;return new Promise(function(i){var r=t.node,c=function(){r.emit(n.STAY_COMPLETE),t.autoHide?e._concealPromptASM(t).then(function(){i()}):i()};switch(r.active=!0,t.state){case o.Show:r.once(n.SHOW_COMPLETE,function(){t.state=o.Stay,t[n.STAY_COMPLETE]=c,t.scheduleOnce(c,t.stayTime*t.textStr.length)});break;case o.Stay:t[n.STAY_COMPLETE]&&t.unschedule(t[n.STAY_COMPLETE]),t[n.STAY_COMPLETE]=c,t.scheduleOnce(c,t.stayTime*t.textStr.length);break;case o.Hide:r.stopAllActions(),t.state=o.Show;var a=t.showTime*(1-r.opacity/255)+.05;cc.tween(r).to(a,{opacity:255}).call(function(){r.emit(n.SHOW_COMPLETE)}).start(),i(e._showDialogASM(t));break;case o.Disable:t.state=o.Show,cc.tween(r).to(t.showTime,{opacity:255}).call(function(){r.emit(n.SHOW_COMPLETE)}).start(),i(e._showDialogASM(t))}})},e.prototype._concealPromptASM=function(t){return new Promise(function(e){var i=t.node;switch(t.state){case o.Show:i.stopAllActions(),t.state=o.Hide;var r=t.hideTime*(1-i.opacity/255);cc.tween(i).to(r,{opacity:0}).call(function(){i.emit(n.HIDE_COMPLETE),t.state=o.Disable,e(),i.active=!1}).start();break;case o.Stay:t[n.STAY_COMPLETE]&&(t.unschedule(t[n.STAY_COMPLETE]),t[n.STAY_COMPLETE]=null),t.state=o.Hide,cc.tween(i).to(t.hideTime,{opacity:0}).call(function(){i.emit(n.HIDE_COMPLETE),t.state=o.Disable,e(),i.active=!1}).start();break;case o.Hide:break;case o.Disable:e()}})},e.EventType={SHOW_DIALOG:"SHOW_DIALOG",SHOW_DIALOG_IMMED:"SHOW_DIALOG_IMMED",HIDE_DIALOG:"HIDE_DIALOG",HIDE_DIALOG_IMMED:"HIDE_DIALOG_IMMED",HIDE_ALL_DIALOG:"HIDE_ALL_DIALOG",REGISTER_DIALOG_COM:"REGISTER_DIALOG_COM"},i=c([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{}],"327_6_LevelCtrl":[function(t,e,i){"use strict";cc._RF.push(e,"0a676dYm3tHPKCo5xKBAAug","327_6_LevelCtrl");var o=__extends,n=__decorate,r=__awaiter,c=__generator;Object.defineProperty(i,"__esModule",{value:!0});var a=t("AudioManager"),s=t("327_6_DialogSys"),l=cc._decorator,u=l.ccclass,d=l.property,h=Array.from({length:5},function(){return{q:{str:"\u9009\u5de6\u8fb9\u8fd8\u662f\u9009\u53f3\u8fb9\u5462\uff1f",id:1,a:"327_6_2"},a:[{str:"\u6211\u9009\u5de6\u8fb9",a:"327_6_3"},{str:"\u6211\u9009\u53f3\u8fb9",a:"327_6_4"}]}}),f={s:[{str:"\u522b\u4eba\u4e3a\u4ec0\u4e48\u90fd\u95ee\u6211\u6ca1\u5e26\u8471\u51fa\u6765\u554a",a:"327_6_5"},{str:"\u8001\u516c\u4e00\u76f4\u8ba9\u6211\u53eb\u4ed6\u8fbe\u4ee4\uff0c\u662f\u4e3a\u5565\u5462",a:"327_6_6"}],f:[{str:"\u8fd9\u8863\u670d\u8ddf\u88e4\u5b50\u989c\u8272\u4e0d\u4e00\u6837\uff0c\u770b\u7740\u597d\u5947\u602a",a:"327_6_7"},{str:"\u8fd9\u889c\u5b50\u8ddf\u8863\u670d\u989c\u8272\u4e0d\u4e00\u6837\uff0c\u770b\u7740\u597d\u5947\u602a",a:"327_6_8"},{str:"\u8fd9\u5047\u53d1\u8ddf\u8863\u670d\u989c\u8272\u4e0d\u4e00\u6837\uff0c\u770b\u7740\u597d\u5947\u602a",a:"327_6_9"},{str:"\u8fd9\u5934\u9970\u8ddf\u8863\u670d\u989c\u8272\u4e0d\u4e00\u6837\uff0c\u770b\u7740\u597d\u5947\u602a",a:"327_6_10"}]},p=[{str:"\u8001\u5a46\uff0c\u901b\u8857\u5c31\u9009\u6211\u7ed9\u4f60\u6311\u7684\u4e24\u5957\u5427",id:1,a:"327_6_1"}],_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemBox=null,e.girlFriend=null,e.player=null,e.btn=null,e.endScene=null,e.selectRecord=[],e._curAudio=-1,e}return o(e,t),Object.defineProperty(e.prototype,"curAudio",{get:function(){return this._curAudio},set:function(t){-1!==this._curAudio&&cc.audioEngine.stop(this._curAudio),this._curAudio=t},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.btn.active=!1,this.itemBox.active=!1,this.endScene.active=!1},e.prototype.start=function(){return r(this,void 0,void 0,function(){var t,e=this;return c(this,function(i){switch(i.label){case 0:t=0,i.label=1;case 1:return t<p.length?[4,this.showDialog(p[t])]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:t=0,i.label=5;case 5:return t<h.length?[4,this.showQuestion(t)]:[3,8];case 6:i.sent(),i.label=7;case 7:return t++,[3,5];case 8:return cc.tween(this.itemBox).to(1,{opacity:0}).call(function(){e.end()}).start(),[2]}})})},e.prototype.showQuestion=function(t){return r(this,void 0,void 0,function(){var e=this;return c(this,function(){return[2,new Promise(function(i){return r(e,void 0,void 0,function(){var e,o,n,s=this;return c(this,function(l){switch(l.label){case 0:return e=function(){var e;s.itemBox.active=!1,s.itemBox.children.forEach(function(e,i){e.active=t===i}),s.itemBox.active=!0,null===(e=s.itemBox.getComponent(cc.Animation))||void 0===e||e.play()},o=function(e){return r(s,void 0,void 0,function(){var n,r,s,l=this;return c(this,function(c){switch(c.label){case 0:switch(a.default.playEffect(a.default.audioName.BUTTON),n=e.getCurrentTarget().name,this.btn.active=!1,this.btn.children.forEach(function(t){t.off(cc.Node.EventType.TOUCH_END,o,l)}),r=null,s=null,this.player.children.forEach(function(t){t.active=!0}),this.scheduleOnce(function(){l.player.children.forEach(function(t){t.active=!1})},1),n){case"left":r=h[t].a[0],s=this.itemBox.children[t].children[0],this.showSelectAnim("left");break;case"right":r=h[t].a[1],s=this.itemBox.children[t].children[1],this.showSelectAnim("right")}return[4,this.showDialog(r)];case 1:return c.sent(),this.closeSelectAnim(),this.itemBox.children[t].children.forEach(function(t){t.opacity=255}),[4,this.showNode(s)];case 2:return c.sent(),i(),[2]}})})},this.btn.children.forEach(function(t){t.on(cc.Node.EventType.TOUCH_END,o,s)}),this.btn.active=!0,e(),null===(n=this.btn.getComponent(cc.Animation))||void 0===n||n.play(),[4,this.showDialog(h[t].q)];case 1:return l.sent(),[2]}})})})]})})},e.prototype.showNode=function(t){return r(this,void 0,void 0,function(){var e=this;return c(this,function(){return[2,new Promise(function(i){return r(e,void 0,void 0,function(){var e,o,n,r,a,s,l=this;return c(this,function(c){switch(c.label){case 0:return t.opacity=0,e=t.name.split("_"),(o=this.girlFriend.getChildByName(t.name)||(null===(s=this.girlFriend.getChildByName(e[0]))||void 0===s?void 0:s.getChildByName(e[1])))?(n=o.getComponent(cc.Animation),r=function(t){return new Promise(function(e){var i=t.getPosition(),o=t.scale;t.active=!0,cc.tween(t).set({scale:1.1*o,opacity:128,position:cc.v3(i.add(cc.v2(0,25)))}).to(.5,{scale:o,opacity:255,position:cc.v3(i)}).call(function(){e()}).start()})},a=function(){var t=l.girlFriend.getChildByName("hand");switch(e[0]){case"top":for(var i=0,o=t.children;i<o.length;i++)for(var n=0,c=o[i].children;n<c.length;n++){var a=c[n];a.name===e[1]&&r(a)}}},this.selectRecord.push(e[1]),n?(n.once(cc.Animation.EventType.FINISHED,function(){a(),i()},this),o.active=!0,n.play(),[3,3]):[3,1]):(i(),[2]);case 1:return a(),[4,r(o)];case 2:c.sent(),i(),c.label=3;case 3:return[2]}})})})]})})},e.prototype.showSelectAnim=function(t){var e,i=this.girlFriend.getChildByName("hand");i.active=!0,null===(e=i.getComponent(cc.Animation))||void 0===e||e.play(t)},e.prototype.closeSelectAnim=function(){var t,e=this.girlFriend.getChildByName("hand");e.active=!0,null===(t=e.getComponent(cc.Animation))||void 0===t||t.play("idle")},e.prototype.showDialog=function(t){return r(this,void 0,void 0,function(){var e=this;return c(this,function(){return[2,new Promise(function(i){return r(e,void 0,void 0,function(){var e;return c(this,function(o){switch(o.label){case 0:return t.a?(e=this,[4,a.default.playEffect(t.a)]):[3,2];case 1:e.curAudio=o.sent(),o.label=2;case 2:return cc.director.emit(s.default.EventType.SHOW_DIALOG,t.str,t.id,function(){i()}),[2]}})})})]})})},e.prototype.end=function(){return r(this,void 0,void 0,function(){var t,e,i,o,n=this;return c(this,function(){return t=this.endScene.getChildByName("gf"),this.girlFriend.parent=t,this.girlFriend.setPosition(0,0),this.endScene.active=!0,this.endScene.opacity=0,e=this.selectRecord.every(function(t){return t===n.selectRecord[0]}),i=this.selectRecord.findIndex(function(t){return t!==n.selectRecord[0]}),o=e?f.s:f.f,cc.tween(this.endScene).to(.5,{opacity:255}).delay(.5).call(function(){return r(n,void 0,void 0,function(){var t=this;return c(this,function(n){switch(n.label){case 0:if(!e)return[3,6];switch(this.selectRecord[0]){case"miku":return[3,1];case"02":return[3,3]}return[3,5];case 1:return[4,this.showDialog(o[0])];case 2:return n.sent(),[3,5];case 3:return[4,this.showDialog(o[1])];case 4:return n.sent(),[3,5];case 5:return[3,8];case 6:return[4,this.showDialog(o[i-1])];case 7:n.sent(),n.label=8;case 8:return this.scheduleOnce(function(){e?t.node.getComponent("LevelCtrl_CommonResult").onGameSucc():t.node.getComponent("LevelCtrl_CommonResult").onGameFail()},1),[2]}})})}).start(),[2]})})},n([d(cc.Node)],e.prototype,"itemBox",void 0),n([d(cc.Node)],e.prototype,"girlFriend",void 0),n([d(cc.Node)],e.prototype,"player",void 0),n([d(cc.Node)],e.prototype,"btn",void 0),n([d(cc.Node)],e.prototype,"endScene",void 0),n([u],e)}(cc.Component);i.default=_,cc._RF.pop()},{"327_6_DialogSys":"327_6_DialogSys",AudioManager:void 0}]},{},["327_6_DialogCom","327_6_DialogSys","327_6_LevelCtrl"]);