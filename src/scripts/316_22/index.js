window.__require=function e(t,n,i){function r(c,s){if(!n[c]){if(!t[c]){var a=c.split("/");if(a=a[a.length-1],!t[a]){var u="function"==typeof __require&&__require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var l=n[c]={exports:{}};t[c][0].call(l.exports,function(e){return r(t[c][1][e]||e)},l,l.exports,e,t,n,i)}return n[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<i.length;c++)r(i[c]);return r}({"316_22_LevelCtrl":[function(e,t,n){"use strict";cc._RF.push(t,"27fedAb39NJeqgzi3KOSKVu","316_22_LevelCtrl");var i=__extends,r=__decorate,o=__awaiter,c=__generator;Object.defineProperty(n,"__esModule",{value:!0});var s=e("LevelCtrl_CommonResult"),a=e("AssetManager"),u=e("AudioManager"),l=e("316_DialogSys"),h=e("316_ActionTool"),d=e("316_AudioFunc"),f=cc._decorator,v=f.ccclass,_=f.property,p=[{str:"\u5927\u738b\uff0c\u4eca\u5929\u6211\u4eec\u6765\u73a9\u4e00\u4e2a\u5f88\u65b0\u7684\u4e1c\u897f",audio:"lv316_22_1-1"},{str:"\u4ed6\u4eec\u8bf4\u662f\u8003\u65af\u666e\u96f7\uff0c\u5927\u738b\u4f60\u5148\u628a\u773c\u775b\u95ed\u4e0a",audio:"lv316_22_1-2"}],g=[{str:"\u5927\u738b\u9009\u54ea\u4ef6\u8863\u670d\uff0c\u81e3\u59be\u5c31\u7a7f\u54ea\u4ef6\u8863\u670d",audio:"lv316_22_2-1"},{str:"\u5927\u738b\uff0c\u4f60\u731c\u54ea\u4ef6\u8ddf\u59be\u8eab\u66f4\u914d\u5462\uff1f",audio:"lv316_22_3-1"},{str:"\u6700\u540e\u4e00\u4e2a\uff0c\u5927\u738b\u731c\u4e0b\u54ea\u8fb9\u7684\u66f4\u597d\u770b",audio:"lv316_22_4-2"},{str:"\u6c90\u6d74\u524d\uff0c\u5927\u738b\u53ef\u8981\u4e0e\u81e3\u59be\u5171\u821e\u4e00\u66f2",audio:"lv316_22_5-1"}],y=[[[{str:"\u5927\u738b\uff0c\u6211\u8003\u65af\u8fd9\u4e2a\u732b\u5973\u597d\u770b\u5417\uff1f",audio:"lv316_22_2-2"}],[{str:"\u5927\u738b\uff0c\u4f26\u5bb6\u4e0d\u559c\u6b22\u8fd9\u4ef6\u5566",audio:"lv316_22_2-3"}]],[[{str:"\u8fd9\u4ef6\u4e5f\u592a\u6734\u7d20\u4e86\uff0c\u81e3\u59be\u7a7f\u7740\u4e0d\u597d\u770b",audio:"lv316_22_3-3"}],[{str:"\u54ce\u5440\uff0c\u5927\u738b\u80af\u5b9a\u5077\u770b\u5230\u53f3\u8fb9\u7684\u662f\u5976\u725b\u88c5\u4e86",audio:"lv316_22_3-2"},{str:"\u4e0d\u884c\u8fd9\u6b21\u6211\u5f97\u81ea\u5df1\u6321\u7740",audio:"lv316_22_4-1"}]],[[{str:"\u4f26\u5bb6\u4e0d\u9ad8\u5174\u5566\uff0c\u54fc",audio:"lv316_22_4-4"}],[{str:"\u5927\u738b\uff0c\u8fd9\u5957\u5154\u5973\u90ce\u597d\u770b\u5427\uff01",audio:"lv316_22_4-3"}]],[[{str:"\u5be1\u4eba\u6b63\u6709\u6b64\u610f\uff0c\u7231\u5983\u901f\u6765",dId:1,audio:"lv316_22_5-4"},{str:"\u5927\u738b\uff0c\u4f73\u4eba\u5728\u65c1\u4e3a\u4f55\u6267\u610f\u8df3\u821e\u5462\uff0c\u81e3\u59be\u4e0d\u597d\u73a9\u5417",audio:"lv316_22_5-2"}],[{str:"\u4e0b\u6b21\u5427\uff0c\u5be1\u4eba\u60f3\u548c\u7231\u5983\u5c3d\u5feb\u5171\u6d74",dId:1,audio:"lv316_22_5-5"},{str:"\u5927\u738b\uff0c\u4f60\u592a\u6027\u6025\u4e86\uff0c\u8fd9\u8863\u670d\u8fd8\u5728\u5462",audio:"lv316_22_5-3"}]]],C=[{str:"\u81e3\u59be\u8fd9\u5c31\u6765\u5e2e\u5927\u738b\u6d17\u811a\u6309\u6469~",audio:"lv316_22_6-1"}],N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clothesRack=null,t.role=null,t.btn=null,t.hand=null,t.clothes=null,t.screen=null,t.dialog=null,t._curQ=0,t._curAudioId=-1,t}return i(t,e),Object.defineProperty(t.prototype,"curAudioId",{get:function(){return this._curAudioId},set:function(e){-1!==this._curAudioId&&cc.audioEngine.stop(this._curAudioId),this._curAudioId=e},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){var e,t=this;this.dialog=this.node.getComponentInChildren(l.default),this.clothesRack.children.forEach(function(e){e.active=!1}),this.btn.active=!1,this.hand.active=!1,this.clothes.active=!1,this.screen.active=!1;var n=null===(e=this.role.getChildByName("female"))||void 0===e?void 0:e.getChildByName("clothes");n&&(n.active=!1),cc.tween(this.role).to(1,{scaleY:1.01}).to(1,{scaleY:1}).union().repeatForever().start(),a.default.loadSoundEffect_fileDir("AudioClip/lv_316/22",function(){return o(t,void 0,void 0,function(){var e,t,n;return c(this,function(i){switch(i.label){case 0:e=0,t=p,i.label=1;case 1:return e<t.length?(n=t[e],[4,this.playSentence(n)]):[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[4,this.showAniNode(this.hand)];case 5:return i.sent(),[4,this.playSentence(g[this._curQ])];case 6:return i.sent(),this.showClothes(),this.showBtns(),[2]}})})})},t.prototype.onBtnClick=function(e){return o(this,void 0,void 0,function(){var t=this;return c(this,function(n){switch(n.label){case 0:switch(this.btn.children.forEach(function(e){e.off(cc.Node.EventType.TOUCH_END,t.onBtnClick,t)}),u.default.playEffect(u.default.audioName.BUTTON),this.hideAniNode(this.btn),e.getCurrentTarget().getSiblingIndex()){case 0:return[3,1];case 1:return[3,3]}return[3,5];case 1:return[4,this.triggerAnswer(this._curQ,1)];case 2:return n.sent(),[3,5];case 3:return[4,this.triggerAnswer(this._curQ,2)];case 4:return n.sent(),[3,5];case 5:return[2]}})})},t.prototype.triggerAnswer=function(e,t){return o(this,void 0,void 0,function(){var n,i,r,o,s,a,u,l=this;return c(this,function(c){switch(c.label){case 0:return n=y[e][t-1],this.hideAniNode(this.clothes),e<g.length-1&&this.clothesRack.children[e-1]?[4,this.showAniNode(this.clothesRack.children[e-1])]:[3,2];case 1:c.sent(),c.label=2;case 2:return[4,this.roleWearClothes(e,t)];case 3:switch(c.sent(),e+"-"+t){case"2-1":case"1-1":case"0-2":case"3-1":case"3-2":return[3,4];case"1-2":case"0-1":return[3,5];case"2-2":return[3,7]}return[3,9];case 4:a=this.role.getChildByName("female"),(i=a.getChildByName("clothes")).off(cc.Node.EventType.TOUCH_START),i.off(cc.Node.EventType.TOUCH_MOVE),i.off(cc.Node.EventType.TOUCH_END),i.off(cc.Node.EventType.TOUCH_CANCEL),this.showFace("angry"),c.label=5;case 5:return[4,this.hideAniNode(this.hand)];case 6:return c.sent(),[3,9];case 7:return[4,this.hideAniNode(this.screen)];case 8:return c.sent(),this.showFace("normal"),[3,9];case 9:r=0,o=n,c.label=10;case 10:return r<o.length?(s=o[r],[4,this.playSentence(s)]):[3,13];case 11:c.sent(),c.label=12;case 12:return r++,[3,10];case 13:switch(e+"-"+t){case"0-1":return[3,14];case"1-2":return[3,16]}return[3,18];case 14:return[4,this.showAniNode(this.hand)];case 15:return c.sent(),[3,18];case 16:return[4,this.showAniNode(this.screen)];case 17:return c.sent(),this.showFace("hint"),[3,18];case 18:switch(e+"-"+t){case"2-1":case"1-1":case"0-2":case"3-1":case"3-2":return[3,19];case"2-2":return[3,20]}return[3,21];case 19:return this.fail(),[3,26];case 20:this.showFace("blush"),c.label=21;case 21:return this._curQ++,this._curQ<g.length-1?[4,this.playSentence(g[this._curQ])]:[3,23];case 22:return c.sent(),this.showClothes(),this.showBtns(),[3,25];case 23:return[4,this.playSentence(g[this._curQ])];case 24:c.sent(),this.showBtns(1),a=this.role.getChildByName("female"),u=a.getChildByName("clothes"),h.default.regSlideEvent(u,function(e,t){u.getBoundingBoxToWorld().intersects(l.clothesRack.getBoundingBoxToWorld())?(t(),u.active=!1,l.hideAniNode(l.btn),l.success()):l.scheduleOnce(function(){u.scale=1.7},.6)}),c.label=25;case 25:return[3,26];case 26:return[2]}})})},t.prototype.showBtns=function(e){return void 0===e&&(e=0),o(this,void 0,void 0,function(){var t=this;return c(this,function(n){switch(n.label){case 0:return this.btn.children.forEach(function(n){n.on(cc.Node.EventType.TOUCH_END,t.onBtnClick,t),n.children.forEach(function(t){t.active=t.getSiblingIndex()===e})}),[4,this.showAniNode(this.btn)];case 1:return n.sent(),[2]}})})},t.prototype.showClothes=function(){return o(this,void 0,void 0,function(){var e,t,n=this;return c(this,function(i){switch(i.label){case 0:return e=this.clothes.getChildByName("left"),t=this.clothes.getChildByName("right"),e.children.forEach(function(e){e.active=e.getSiblingIndex()===n._curQ}),t.children.forEach(function(e){e.active=e.getSiblingIndex()===n._curQ}),[4,this.showAniNode(this.clothes)];case 1:return i.sent(),[2]}})})},t.prototype.roleWearClothes=function(e,t){return o(this,void 0,void 0,function(){var n,i,r;return c(this,function(o){switch(o.label){case 0:return n=this.role.getChildByName("female"),i=n.getChildByName("clothes"),(r=i.children.find(function(n){return n.name===e+1+"-"+t}))?(i.children.forEach(function(e){e.active=e===r}),[4,this.showAniNode(i)]):[2];case 1:return o.sent(),[2]}})})},t.prototype.showFace=function(e){var t=this.role.getChildByName("female").getChildByName("face");if(!t||"normal"===e)return t.active=!1;t.active=!0,t.children.forEach(function(t){t.active=t.name===e})},t.prototype.showAniNode=function(e){return o(this,void 0,void 0,function(){return c(this,function(){return[2,new Promise(function(t){var n=e.getComponent(cc.Animation);if(!n)return t();n.defaultClip.wrapMode=cc.WrapMode.Reverse,n.once(cc.Animation.EventType.FINISHED,function(){t()}),e.active=!0,n.play()})]})})},t.prototype.hideAniNode=function(e){return o(this,void 0,void 0,function(){var t=this;return c(this,function(){return[2,new Promise(function(n){if(!e.active)return n();var i=e.getComponent(cc.Animation);if(!i)return e.active=!1,n();var r=i.defaultClip.name+"_out",o=i.getClips().find(function(e){return e.name===r})||i.defaultClip;o.wrapMode=cc.WrapMode.Normal,i.addClip(o,r),i.once(cc.Animation.EventType.FINISHED,function(){t.scheduleOnce(function(){n(),e.active=!1},.5)}),i.play(r)})]})})},t.prototype.playSentence=function(e){return o(this,void 0,void 0,function(){var t;return c(this,function(n){switch(n.label){case 0:return e.dId=e.dId||0,e.audio?(t=this,[4,u.default.playEffect(e.audio)]):[3,2];case 1:t.curAudioId=n.sent(),n.label=2;case 2:return[4,this.dialog.showDialog(e.str,e.dId)];case 3:return n.sent(),[2]}})})},t.prototype.fail=function(){this.node.getComponent(s.default).onGameFail()},t.prototype.success=function(){return o(this,void 0,void 0,function(){var e,t,n;return c(this,function(i){switch(i.label){case 0:return[4,this.showAniNode(this.clothesRack.children[2])];case 1:i.sent(),e=0,t=C,i.label=2;case 2:return e<t.length?(n=t[e],[4,this.playSentence(n)]):[3,5];case 3:i.sent(),i.label=4;case 4:return e++,[3,2];case 5:return this.node.getComponent(s.default).onGameSucc(),[2]}})})},r([_(cc.Node)],t.prototype,"clothesRack",void 0),r([_(cc.Node)],t.prototype,"role",void 0),r([_(cc.Node)],t.prototype,"btn",void 0),r([_(cc.Node)],t.prototype,"hand",void 0),r([_(cc.Node)],t.prototype,"clothes",void 0),r([_(cc.Node)],t.prototype,"screen",void 0),r([d.bgm_316(6),v],t)}(cc.Component);n.default=N,cc._RF.pop()},{"316_ActionTool":void 0,"316_AudioFunc":void 0,"316_DialogSys":void 0,AssetManager:void 0,AudioManager:void 0,LevelCtrl_CommonResult:void 0}]},{},["316_22_LevelCtrl"]);