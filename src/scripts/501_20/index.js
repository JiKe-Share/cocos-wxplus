window.__require=function t(i,o,s){function e(n,a){if(!o[n]){if(!i[n]){var l=n.split("/");if(l=l[l.length-1],!i[l]){var h="function"==typeof __require&&__require;if(!a&&h)return h(l,!0);if(c)return c(l,!0);throw new Error("Cannot find module '"+n+"'")}n=l}var r=o[n]={exports:{}};i[n][0].call(r.exports,function(t){return e(i[n][1][t]||t)},r,r.exports,t,i,o,s)}return o[n].exports}for(var c="function"==typeof __require&&__require,n=0;n<s.length;n++)e(s[n]);return e}({lv501_20_Ctrl:[function(t,i,o){"use strict";cc._RF.push(i,"0f1da45xDZPK62VLM271pe3","lv501_20_Ctrl");var s=__extends,e=__decorate;Object.defineProperty(o,"__esModule",{value:!0});var c=t("MathTool"),n=t("Game"),a=t("AudioManager"),l=cc._decorator,h=l.ccclass,r=l.property,p=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.tasklist=null,i.sccbtn=null,i.titlelist=[],i.dd=null,i.successnum=9,i.localnum=0,i.plan=0,i.cleanpos=[],i.cleamposnum=0,i.progressBar=null,i.node_splash=null,i.node_ef_stars=null,i.sccliz=null,i.isworking=!1,i.isover=!1,i.bq=null,i.count=0,i.isplay=!1,i}return s(i,t),i.prototype.onLoad=function(){var t=this;this.dd=this.node.getChildByName("dd"),this.title=this.node.getChildByName("title"),this.progressBar=this.node.getChildByName("progressBar").getComponent(cc.ProgressBar),this.node_ef_stars=this.node.getChildByName("ef_stars"),this.sccliz=this.node.getChildByName("success"),this.node_splash=this.node.getChildByName("splash"),this.UpNode(),cc.sys.isBrowser&&cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(i){i.keyCode==cc.macro.KEY.space&&(t.plan++,t.UpNode())},this)},i.prototype.UpNode=function(){for(var t=0;t<this.tasklist.childrenCount;t++)t==this.plan?this.tasklist.children[t].active=!0:this.tasklist.children[t].active=!1;if(this.title.getComponent(cc.Label).string=this.titlelist[this.plan],this.toolNode=this.tasklist.children[this.plan].getChildByName("tool"),this.tool=this.toolNode.getChildByName("tool"),this.action=this.tasklist.children[this.plan].getChildByName("action"),this.mask=this.tasklist.children[this.plan].getChildByName("mask"),this.rect=this.tasklist.children[this.plan].getChildByName("rect"),this.startsca=this.tool.scale,this.startpos=this.tool.position,4==this.plan||1==this.plan||7==this.plan){this.cleanpos=[],this.cleamposnum=0;var i=this.tool.children[0].width/4;for(t=0;t<720/i;t++)for(var o=0;o<1280/i;o++){var s=cc.v2(i*t-360,640-i*o),e=this.mask.getComponent(cc.PolygonCollider).points;this.containsPoint(s.x,s.y,e)&&this.cleanpos.push(s)}}9===this.plan?(this.tool.position=cc.v3(0,-250),this.action.parent.scale=1.5,cc.tween(this.action.parent).to(.5,{scale:1}).start()):cc.tween(this.toolNode).to(.5,{position:cc.v3(0,0)}).start(),8===this.plan||9===this.plan?this.action.active=!0:this.action.active=!1,this.tool.on(cc.Node.EventType.TOUCH_START,this.TouchStart,this),this.tool.on(cc.Node.EventType.TOUCH_MOVE,this.TouchSMove,this),this.tool.on(cc.Node.EventType.TOUCH_END,this.TouchSEnd,this),this.tool.on(cc.Node.EventType.TOUCH_CANCEL,this.TouchSEnd,this)},i.prototype.TouchStart=function(t){this.isworking||(t.target.scale=1.1*this.startsca,a.default.playEffect(a.default.audioName.BUTTON),this.toolNode.getChildByName("tool_icon")&&(this.toolNode.getChildByName("tool_icon").active=!1))},i.prototype.TouchSMove=function(t){if(!this.isworking){var i=this.node.convertToNodeSpaceAR(t.getLocation());if(9===this.plan?this.Task10Func():this.tool.setPosition(this.tool.getPosition().add(t.getDelta().mul(.4444444444444444))),4==this.plan||1==this.plan||7==this.plan){var o=this.rect,s=cc.rect(o.x,o.y,o.width,o.height),e=cc.v2(i.x+this.tool.children[0].x,i.y+this.tool.children[0].y);c.default.rectPoint(e,s)&&this.Task1Func()}this.localnum,this.successnum}},i.prototype.BtnOffClick=function(){this.tool.off(cc.Node.EventType.TOUCH_START,this.TouchStart,this),this.tool.off(cc.Node.EventType.TOUCH_MOVE,this.TouchSMove,this),this.tool.off(cc.Node.EventType.TOUCH_END,this.TouchSEnd,this),this.tool.off(cc.Node.EventType.TOUCH_CANCEL,this.TouchSEnd,this)},i.prototype.TouchSEnd=function(t){t.target.scale=this.startsca,this.rectrect(t.target,this.rect)&&(8==this.plan&&(t.target.active=!1,this.Mission9Handler()),6==this.plan&&(t.target.active=!1,this.Task2Func()),5==this.plan&&(t.target.active=!1,this.Task6Func()),3==this.plan&&(t.target.active=!1,this.Task4Func()),0!=this.plan&&2!=this.plan||(t.target.active=!1,this.Task2Func())),4!=this.plan&&1!=this.plan&&7!=this.plan||(this.cleamposnum>this.cleanpos.length/10*8?(this.localnum=this.successnum,this.SuccessFunc(),this.isplay=!1,cc.audioEngine.stopAllEffects()):this.tool.angle=0),this.tool.position=this.startpos},i.prototype.Task2Func=function(){var t=this;this.action.active=!0,this.action.y=50,this.playaudio("lv501_fang"),cc.tween(this.action).to(.5,{y:0}).call(function(){t.successnum=0,t.SuccessFunc()}).start()},i.prototype.playaudio=function(t,i){void 0===i&&(i=!1),cc.audioEngine.stopAllEffects(),a.default.playEffect(t,i)},i.prototype.Task4Func=function(){var t=this;this.action.active=!0;var i=this.action.children[0];i.active=!0;var o=this.mask.children[1];this.playaudio("lv501_fang"),i.y=275,cc.tween(i).to(.5,{y:100}).call(function(){}).start(),cc.tween(o).to(.5,{scaleY:.4}).call(function(){o.active=!1,t.action.children[1].active=!0,t.successnum=0,t.SuccessFunc()}).start()},i.prototype.Task1Func=function(){var t=this.tool.children[0],i=t.x+this.tool.x,o=t.y+this.tool.y;this._addCircle(cc.v2(i,o),t.width,t.height,this.mask);for(var s=0;s<this.cleanpos.length;s++)if(this.cleanpos[s]){var e=this.tool.x+t.x,c=this.tool.y+t.y;if(this.rectToPoints(this.cleanpos[s],cc.v2(e,c),t.width,t.height)){this.cleamposnum+=1,this.cleanpos[s]=null;var n=this.cleamposnum/(this.cleanpos.length/10*9);n>1?this.onRefreshProgressBar(1):(this.isplay||(this.playaudio("lv501_18_2",!0),this.isplay=!0),this.onRefreshProgressBar(n))}}},i.prototype.Task6Func=function(){var t=this;this.successnum=2,this.action.active=!0,0===this.localnum?(this.localnum++,this.action.children[0].active=!0,this.action.children[0].position=cc.v3(-170,-30),cc.tween(this.action.children[0]).to(.5,{position:cc.v3(-122,-30)}).call(function(){t.tool.active=!0,t.tool.children[0].scaleX=-1,t.toolNode.x=-800,cc.tween(t.toolNode).to(.5,{position:cc.v3(0,0)}).call(function(){}).start()}).start()):(this.localnum++,this.action.children[1].active=!0,this.action.children[1].position=cc.v3(170,-30),cc.tween(this.action.children[1]).to(.5,{position:cc.v3(122,-30)}).call(function(){t.SuccessFunc()}).start()),this.playaudio("lv501_fang")},i.prototype.Mission9Handler=function(){var t=this;this.playaudio("lv501_fang"),this.successnum=0,this.action.children[0].active=!0,this.action.children[0].y=-300,cc.tween(this.action.children[0]).to(1,{y:-132}).call(function(){t.SuccessFunc()}).start()},i.prototype.Task10Func=function(){var t=this;this.isworking=!0,this.successnum=0,this.action.children[4].active=!0,this.action.children[4].y=-132,cc.tween(this.action.children[4]).to(.5,{y:-275}).call(function(){t.playaudio("lv501_20_1"),cc.tween(t.mask).to(.1,{y:130}).call(function(){t.action.children[4].active=!1,cc.tween(t.mask.parent).by(.3,{y:-230}).by(.3,{y:230}).by(.3,{y:-230}).by(.3,{y:230}).call(function(){t.scheduleOnce(function(){t.node_ef_stars.active=!0},.5),t.scheduleOnce(function(){t.SuccessFunc()},1.5)}).start()}).start()}).start()},i.prototype.moveTween=function(t,i,o){void 0===i&&(i=.5),void 0===o&&(o=null),cc.tween(t).to(i,{position:cc.v3(0,0)}).call(function(){o&&o()}).start()},i.prototype.SuccessFunc=function(){var t=this;this.successnum==this.localnum&&(this.BtnOffClick(),this.plan+=1,this.localnum=0,this.progressBar.node.opacity=0,this.plan==this.tasklist.childrenCount?(this.node_ef_stars.active=!0,this.scheduleOnce(function(){t.GameWin()},1.5)):cc.tween(this.toolNode).to(.5,{position:cc.v3(800,0)}).call(function(){t.UpNode()}).start())},i.prototype.containsPoint=function(t,i,o){for(var s=o.length,e=0,c=0;c<s;++c){var n=o[c].x,a=o[c].y,l=o[(c+1)%s].x,h=o[(c+1)%s].y;a!=h&&(i<Math.min(a,h)||i>=Math.max(a,h)||(i-a)*(l-n)/(h-a)+n>t&&e++)}return e%2==1},i.prototype.rectToPoints=function(t,i,o,s){return t.x>i.x-o&&t.x<i.x+o&&t.y>i.y-s&&t.y<i.y+s},i.prototype.GameWin=function(){var t=this;a.default.playEffect(a.default.audioName.CRRECT),cc.tween(this.dd).to(1,{opacity:255,scale:1}).delay(.5).call(function(){t.dd.scale=0,cc.find("Canvas/game").getComponent(n.default).showResultLayer()}).start()},i.prototype.rectrect=function(t,i){var o=t.getBoundingBoxToWorld(),s=i.getBoundingBoxToWorld();return!!cc.Intersection.rectRect(s,o)},i.prototype.showSplash=function(){cc.Tween.stopAllByTarget(this.node_splash),this.node_splash.opacity=255,cc.tween(this.node_splash).to(1,{opacity:0},{easing:"fade"}).start()},i.prototype.onRefreshProgressBar=function(t){this.progressBar.progress=t,this.progressBar.node.opacity=255},i.prototype._addCircle=function(t,i,o,s){var e=s.getComponent(cc.Mask)._graphics,c=cc.color(0,0,0,255);e.circle(t.x,t.y,i),e.lineWidth=2,e.fillColor=c,e.fill()},e([r(cc.Node)],i.prototype,"tasklist",void 0),e([r(cc.Node)],i.prototype,"sccbtn",void 0),e([r([cc.String])],i.prototype,"titlelist",void 0),e([r(cc.Node)],i.prototype,"bq",void 0),e([h],i)}(cc.Component);o.default=p,cc._RF.pop()},{AudioManager:void 0,Game:void 0,MathTool:void 0}]},{},["lv501_20_Ctrl"]);