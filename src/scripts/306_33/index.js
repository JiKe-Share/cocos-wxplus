window.__require=function e(t,i,o){function s(r,c){if(!i[r]){if(!t[r]){var a=r.split("/");if(a=a[a.length-1],!t[a]){var d="function"==typeof __require&&__require;if(!c&&d)return d(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+r+"'")}r=a}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){return s(t[r][1][e]||e)},h,h.exports,e,t,i,o)}return i[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<o.length;r++)s(o[r]);return s}({"306_33_Guide_33":[function(e,t,i){"use strict";cc._RF.push(t,"a13407F9PBIvpMh9DNeqWDI","306_33_Guide_33");var o=__extends,s=__decorate;Object.defineProperty(i,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,c=n.property,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.guideType=0,t.guideNode=null,t.startSize=new cc.Vec2(.9,.9),t.endSize=new cc.Vec2(1,1),t.isReturn=!1,t.movePos=[],t.moveSpeed=0,t._guideOriginalSize=null,t}return o(t,e),t.prototype.onEnable=function(){switch(this.guideType){case 0:this._onClick();break;case 1:this.isReturn&&(this.movePos=this.movePos.concat(this.movePos.slice().reverse())),this._onSlide()}this._guideOriginalSize=cc.v2(this.guideNode.scaleX,this.guideNode.scaleY)},t.prototype.onDisable=function(){this.guideNode.stopAllActions(),this.guideNode.scaleX=this._guideOriginalSize.x,this.guideNode.scaleY=this._guideOriginalSize.y},t.prototype._onClick=function(){var e=cc.v3(this.startSize.multiply(cc.v2(this.guideNode.scaleX,this.guideNode.scaleY))),t=cc.v3(this.endSize.multiply(cc.v2(this.guideNode.scaleX,this.guideNode.scaleY)));cc.tween(this.guideNode).set({scaleX:e.x,scaleY:e.y}).to(.5,{scaleX:t.x,scaleY:t.y}).to(.5,{scaleX:e.x,scaleY:e.y}).union().repeatForever().start()},t.prototype._onSlide=function(){var e=this,t=cc.v3(this.startSize.multiply(cc.v2(this.guideNode.scaleX,this.guideNode.scaleY))),i=cc.v3(this.endSize.multiply(cc.v2(this.guideNode.scaleX,this.guideNode.scaleY))),o=function t(i){return new Promise(function(o){var s=e.movePos[i].sub(e.guideNode.position).mag()/e.moveSpeed;cc.tween(e.guideNode).to(s,{position:e.movePos[i]}).call(function(){++i>=e.movePos.length?o():o(t(i))}).start()})};(function s(){e.movePos.length<=1||cc.tween(e.guideNode).set({position:e.movePos[0],scaleX:i.x,scaleY:i.y}).to(.2,{scaleX:t.x,scaleY:t.y}).call(function(){o(1).then(function(){cc.tween(e.guideNode).to(.2,{scaleX:i.x,scaleY:i.y}).call(function(){s()}).start()})}).start()})()},s([c({type:cc.Enum({"\u70b9\u51fb":0,"\u6ed1\u52a8":1})})],t.prototype,"guideType",void 0),s([c({type:cc.Node})],t.prototype,"guideNode",void 0),s([c({})],t.prototype,"startSize",void 0),s([c({})],t.prototype,"endSize",void 0),s([c({visible:function(){return 1===this.guideType}})],t.prototype,"isReturn",void 0),s([c({type:[cc.Vec3],visible:function(){return 1===this.guideType}})],t.prototype,"movePos",void 0),s([c({visible:function(){return 1===this.guideType}})],t.prototype,"moveSpeed",void 0),s([r],t)}(cc.Component);i.default=a,cc._RF.pop()},{}],"306_33_LevelCtrl":[function(e,t,i){"use strict";cc._RF.push(t,"5aa74eElXdFsbHP1YVKLRRl","306_33_LevelCtrl");var o=__extends,s=__decorate;Object.defineProperty(i,"__esModule",{value:!0});var n=e("AudioManager"),r=e("306_33_Guide_33"),c=cc._decorator,a=c.ccclass,d=c.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.items_layer=null,t.box=null,t.guideNodes=[],t.itemSprites=[],t.itemTakeOut=[],t.itemPull=[],t.itemSpriteSet=new Set,t.isFirstDrag=!0,t}return o(t,e),t.prototype.onLoad=function(){for(var e=0,t=this.items_layer.children;e<t.length;e++){var i=t[e].getChildByName("sprite");i&&(i.active=!1,this.itemSpriteSet.add(i),this.itemSprites.push(i),this.itemTakeOut.push(!1),this.itemPull.push(!1))}this.node.on(cc.Node.EventType.TOUCH_START,this._onSpriteDragStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onSpriteDragMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onSpriteDragEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onSpriteDragEnd,this),this.box.on(cc.Node.EventType.TOUCH_END,this.takeOutItemSprite,this)},t.prototype._onSpriteDragStart=function(e){var t=e.target;if(this.itemSpriteSet.has(t)){if(this.guideNodes.length>1){this.isFirstDrag=!1;var i=this.guideNodes[1];if(!i)return;i.active=!1}t.parent.setSiblingIndex(this.items_layer.childrenCount-1)}},t.prototype._onSpriteDragMove=function(e){var t=e.target;if(this.itemSpriteSet.has(t)){var i=t.getPosition().add(e.getDelta().mul(.6666666666666666)),o=t.parent.convertToWorldSpaceAR(i),s=this.items_layer.convertToNodeSpaceAR(o);s.x<-(this.items_layer.width-t.width)/2&&(s.x=-(this.items_layer.width-t.width)/2),s.x>(this.items_layer.width-t.width)/2&&(s.x=(this.items_layer.width-t.width)/2),s.y<-(this.items_layer.height-t.height)/2&&(s.y=-(this.items_layer.height-t.height)/2),s.y>(this.items_layer.height-t.height)/2&&(s.y=(this.items_layer.height-t.height)/2);var n=t.parent.convertToNodeSpaceAR(this.items_layer.convertToWorldSpaceAR(s));t.setPosition(n)}},t.prototype._onSpriteDragEnd=function(e){var t=e.target;if(this.itemSpriteSet.has(t))if(t.position.mag()<100)this._onSpritePullSuccess(t);else{var i=t.getPosition().add(e.getDelta().mul(.6666666666666666)),o=t.parent.convertToWorldSpaceAR(i),s=this.items_layer.convertToNodeSpaceAR(o);s.x<-(this.items_layer.width-t.width)/2&&(s.x=-(this.items_layer.width-t.width)/2),s.x>(this.items_layer.width-t.width)/2&&(s.x=(this.items_layer.width-t.width)/2),s.y<-(this.items_layer.height-t.height)/2&&(s.y=-(this.items_layer.height-t.height)/2),s.y>(this.items_layer.height-t.height)/2&&(s.y=(this.items_layer.height-t.height)/2);var n=t.parent.convertToNodeSpaceAR(this.items_layer.convertToWorldSpaceAR(s));t.setPosition(n)}},t.prototype._onSpritePullSuccess=function(e){if(this.itemSpriteSet.has(e)){n.default.playEffect("306_33_succ");var t=this.itemSprites.indexOf(e);e.parent.setSiblingIndex(0),this.itemSpriteSet.delete(e),this.itemPull[t]=!0,e.setPosition(cc.v2(0,0)),e.off(cc.Node.EventType.TOUCH_START),e.off(cc.Node.EventType.TOUCH_MOVE),e.off(cc.Node.EventType.TOUCH_END),e.off(cc.Node.EventType.TOUCH_CANCEL),0==this.itemSpriteSet.size&&this.gameSuccess()}},t.prototype._registerSpriteDragEvent=function(e){e.on(cc.Node.EventType.TOUCH_START,function(){},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(){},this),e.on(cc.Node.EventType.TOUCH_END,function(){},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(){},this)},t.prototype.takeOutItemSprite=function(){var e=this,t=!1,i=this.itemTakeOut.map(function(e,t){return e?-1:t}).filter(function(e){return-1!=e});if(0==i.length)return null;if(1==i.length&&(t=!0),this.guideNodes.length>0){var o=this.guideNodes[0];o&&(o.active=!1)}var s=i[Math.floor(Math.random()*i.length)],n=this.itemSprites[s],c=n.parent,a=c.convertToNodeSpaceAR(this.box.convertToWorldSpaceAR(cc.v2(0,0)));this.itemTakeOut[s]=!0,n.scale=0,n.setPosition(a),n.active=!0,c.setSiblingIndex(this.items_layer.childrenCount-1),cc.tween(n).by(.5,{scale:1,y:300},{easing:cc.easing.fade}).call(function(){if(t&&cc.tween(e.box).to(.5,{scale:0}).call(function(){e.box.active=!1}).start(),e.isFirstDrag&&e.guideNodes.length>1){var i=e.guideNodes[1];if(!i)return;i.active=!1;var o=i.getComponent(r.default);if(!o)return;var s=n.convertToWorldSpaceAR(cc.v3(0,0)),a=c.convertToWorldSpaceAR(cc.v3(0,0)),d=e.node.convertToNodeSpaceAR(s),h=e.node.convertToNodeSpaceAR(a);o.movePos=[],o.movePos.push(d),o.movePos.push(h),i.active=!0}e._registerSpriteDragEvent(n)}).start()},t.prototype.gameSuccess=function(){var e=this;this.scheduleOnce(function(){e.node.getComponent("LevelCtrl_CommonResult").onGameSucc()},.8)},s([d({type:cc.Node})],t.prototype,"items_layer",void 0),s([d({type:cc.Node})],t.prototype,"box",void 0),s([d({type:[cc.Node]})],t.prototype,"guideNodes",void 0),s([a],t)}(cc.Component);i.default=h,cc._RF.pop()},{"306_33_Guide_33":"306_33_Guide_33",AudioManager:void 0}]},{},["306_33_Guide_33","306_33_LevelCtrl"]);